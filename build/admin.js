(()=>{"use strict";var e={n:t=>{var o=t&&t.__esModule?()=>t.default:()=>t;return e.d(o,{a:o}),o},d:(t,o)=>{for(var a in o)e.o(o,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:o[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,o=window.wp.components,a=window.wp.i18n,r=window.wp.apiFetch;var l=e.n(r);const n=window.ReactJSXRuntime;function i({expanded:e}){return(0,n.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e?(0,n.jsx)("polyline",{points:"6 9 12 15 18 9"}):(0,n.jsx)("polyline",{points:"9 6 15 12 9 18"})})}function d({folder:e,selectedId:o,onSelect:r,level:l=0,parentId:s=null,renderWrapper:c,enableKeyboardNav:f=!1,enableAutoExpand:m=!1,enableAria:u=!1}){const v=e=>!(!e.children||0===e.children.length)&&e.children.some(e=>e.id===o||v(e)),p=m&&v(e),[h,g]=(0,t.useState)(p),w=h||p,_=e.children&&e.children.length>0,b=o===e.id;(0,t.useEffect)(()=>{p&&!h&&g(!0)},[p,h]);const x=(0,n.jsxs)("button",{type:"button",className:"vmf-folder-button "+(b?"is-selected":""),style:{paddingLeft:16*l+8+"px"},onClick:()=>r(e.id),onKeyDown:f?t=>{f&&("ArrowRight"===t.key&&_&&!w?(t.preventDefault(),g(!0)):"ArrowLeft"===t.key?(t.preventDefault(),_&&w?g(!1):null!==s&&r(s)):"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),r(e.id)))}:void 0,"aria-current":b?"true":void 0,title:e.name,children:[_&&(0,n.jsx)("span",{className:"vmf-folder-toggle",onClick:t=>{t.stopPropagation(),w&&v(e)&&r(e.id),g(!w)},onKeyDown:f?t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),t.stopPropagation(),w&&v(e)&&r(e.id),g(!w))}:void 0,role:f?"button":void 0,tabIndex:f?0:void 0,"aria-label":w?(0,a.__)("Collapse","virtual-media-folders"):(0,a.__)("Expand","virtual-media-folders"),children:(0,n.jsx)(i,{expanded:w})}),(0,n.jsx)("span",{className:"vmf-folder-name",children:e.name}),"number"==typeof e.count&&(0,n.jsxs)("span",{className:"vmf-folder-count","aria-label":u?`${e.count} ${(0,a.__)("items","virtual-media-folders")}`:void 0,children:["(",e.count,")"]})]}),y=c?c({folderId:e.id,children:x}):x,j=u?{role:"treeitem","aria-expanded":_?w:void 0,"aria-selected":b}:{};return(0,n.jsxs)("li",{className:"vmf-folder-item",...j,children:[y,_&&w&&(0,n.jsx)("ul",{className:"vmf-folder-children",role:u?"group":void 0,children:e.children.map(t=>(0,n.jsx)(d,{folder:t,selectedId:o,onSelect:r,level:l+1,parentId:e.id,renderWrapper:c,enableKeyboardNav:f,enableAutoExpand:m,enableAria:u},t.id))})]})}function s({folders:e,selectedId:t,onSelect:o,uncategorizedCount:r,showAllMedia:l=!0,showUncategorized:i=!0,loading:s,renderWrapper:c,renderUncategorizedWrapper:f,renderHeader:m,enableKeyboardNav:u=!1,enableAutoExpand:v=!1,enableAria:p=!1,className:h="",loadingText:g}){if(s){const e=p?"vmf-folder-tree":"vmf-folder-sidebar";return(0,n.jsx)("div",{className:`${e} ${e}--loading ${h}`,"aria-label":p?(0,a.__)("Media folders","virtual-media-folders"):void 0,children:(0,n.jsx)("p",{"aria-live":p?"polite":void 0,children:g||(0,a.__)("Loading…","virtual-media-folders")})})}const w=(0,n.jsx)("button",{type:"button",className:"vmf-folder-button "+(null===t?"is-selected":""),onClick:()=>o(null),"aria-current":null===t?"true":void 0,children:(0,n.jsx)("span",{className:"vmf-folder-name",children:(0,a.__)("All Media","virtual-media-folders")})}),_=(0,n.jsxs)("button",{type:"button",className:"vmf-folder-button "+("uncategorized"===t?"is-selected":""),onClick:()=>o("uncategorized"),"aria-current":"uncategorized"===t?"true":void 0,children:[(0,n.jsx)("span",{className:"vmf-folder-name",children:(0,a.__)("Uncategorized","virtual-media-folders")}),(0,n.jsxs)("span",{className:"vmf-folder-count","aria-label":p?`${r} ${(0,a.__)("items","virtual-media-folders")}`:void 0,children:["(",r,")"]})]}),b=f?f({children:_}):_,x=p?"nav":"div",y=p?"vmf-folder-tree":"vmf-folder-sidebar";return(0,n.jsxs)(x,{className:`${y} ${h}`,"aria-label":p?(0,a.__)("Media folders","virtual-media-folders"):void 0,children:[m&&m(),(0,n.jsxs)("ul",{className:"vmf-folder-list",role:p?"tree":void 0,"aria-label":p?(0,a.__)("Folder tree","virtual-media-folders"):void 0,children:[l&&(0,n.jsx)("li",{className:"vmf-folder-item",role:p?"treeitem":void 0,"aria-selected":p?null===t:void 0,children:w}),i&&(0,n.jsx)("li",{className:"vmf-folder-item",role:p?"treeitem":void 0,"aria-selected":p?"uncategorized"===t:void 0,children:b}),e.map(e=>(0,n.jsx)(d,{folder:e,selectedId:t,onSelect:o,renderWrapper:c,enableKeyboardNav:u,enableAutoExpand:v,enableAria:p},e.id))]})]})}function c({folderId:e,children:o,className:r=""}){const[l,i]=(0,t.useState)(!1),d=(0,t.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),i(!0)},[]),s=(0,t.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),i(!1)},[]),c=(0,t.useCallback)(t=>{t.preventDefault(),t.stopPropagation(),i(!1);try{const o=t.dataTransfer.getData("text/plain");if(!o)return;const a=JSON.parse(o);if(a.mediaId&&window.vmfMoveToFolder){window.vmfMoveToFolder(a.mediaId,e);const{jumpToFolderAfterMove:t=!1}=window.vmfData||{};t&&window.vmfSelectFolder&&setTimeout(()=>{window.vmfSelectFolder(e)},200)}}catch(e){}},[e]);return(0,n.jsxs)("div",{className:`vmf-droppable-folder ${r} ${l?"is-over":""}`,onDragOver:d,onDragEnter:d,onDragLeave:s,onDrop:c,children:[o,l&&(0,n.jsx)("span",{className:"screen-reader-text",children:(0,a.__)("Drop here to move media to this folder","virtual-media-folders")})]})}(0,t.createContext)(null);const f=window.wp.primitives;var m=(0,n.jsx)(f.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,n.jsx)(f.Path,{d:"M11 12.5V17.5H12.5V12.5H17.5V11H12.5V6H11V11H6V12.5H11Z"})}),u=(0,n.jsx)(f.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,n.jsx)(f.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})}),v=(0,n.jsx)(f.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,n.jsx)(f.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M12 5.5A2.25 2.25 0 0 0 9.878 7h4.244A2.251 2.251 0 0 0 12 5.5ZM12 4a3.751 3.751 0 0 0-3.675 3H5v1.5h1.27l.818 8.997a2.75 2.75 0 0 0 2.739 2.501h4.347a2.75 2.75 0 0 0 2.738-2.5L17.73 8.5H19V7h-3.325A3.751 3.751 0 0 0 12 4Zm4.224 4.5H7.776l.806 8.861a1.25 1.25 0 0 0 1.245 1.137h4.347a1.25 1.25 0 0 0 1.245-1.137l.805-8.861Z"})});function p({folders:e=[],selectedId:r,onRefresh:i,onDelete:d}){const[s,c]=(0,t.useState)(!1),[f,p]=(0,t.useState)(!1),[h,g]=(0,t.useState)(!1),[w,_]=(0,t.useState)(""),[b,x]=(0,t.useState)(0),[y,j]=(0,t.useState)(""),[S,C]=(0,t.useState)(0),[F,N]=(0,t.useState)(!1),[k,E]=(0,t.useState)(""),$=e.find(e=>e.id===r);function T(e,t=0,o=0,a=null){let r=[];const l=e.filter(e=>e.parent===t);for(const t of l){if(null!==a&&t.id===a)continue;const l=o>0?"— ".repeat(o):"";r.push({label:l+t.name,value:String(t.id)}),r=r.concat(T(e,t.id,o+1,a))}return r}function z(e,t="success"){const o=document.createElement("div");o.className=`notice notice-${t} vmf-notice is-dismissible`,o.innerHTML=`<p>${e}</p>`,o.style.cssText="position: fixed; top: 40px; right: 20px; z-index: 100000; max-width: 300px;",document.body.appendChild(o),setTimeout(()=>o.remove(),3e3)}const D=r&&"number"==typeof r;return(0,n.jsxs)("div",{className:"vmf-folder-manager",onClick:e=>e.stopPropagation(),children:[(0,n.jsxs)("div",{className:"vmf-folder-manager-buttons",children:[(0,n.jsx)(o.Button,{icon:m,"aria-label":(0,a.__)("Create Folder","virtual-media-folders"),onClick:t=>{t.stopPropagation(),E("");const o=e.some(e=>e.id===r);x(o?r:0),c(!0)},className:"vmf-folder-manager-button",size:"small",showTooltip:!1}),(0,n.jsx)(o.Button,{icon:u,"aria-label":(0,a.__)("Rename Folder","virtual-media-folders"),onClick:e=>{e.stopPropagation(),$&&(j($.name),C($.parent||0),E(""),p(!0))},disabled:!D,className:"vmf-folder-manager-button",size:"small",showTooltip:!1}),(0,n.jsx)(o.Button,{icon:v,"aria-label":(0,a.__)("Delete Folder","virtual-media-folders"),onClick:e=>{e.stopPropagation(),E(""),g(!0)},disabled:!D,className:"vmf-folder-manager-button",isDestructive:!0,size:"small",showTooltip:!1})]}),s&&(0,n.jsxs)(o.Modal,{title:(0,a.__)("Create Folder","virtual-media-folders"),onRequestClose:()=>c(!1),className:"vmf-folder-modal",children:[(0,n.jsx)(o.TextControl,{label:(0,a.__)("Folder Name","virtual-media-folders"),value:w,onChange:_,placeholder:(0,a.__)("Enter folder name","virtual-media-folders"),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}),(0,n.jsx)(o.SelectControl,{label:(0,a.__)("Parent Folder","virtual-media-folders"),value:String(b),options:[{label:(0,a.__)("None (top level)","virtual-media-folders"),value:"0"},...T(e)],onChange:e=>x(parseInt(e,10)),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}),k&&(0,n.jsx)("p",{className:"vmf-folder-modal-error",children:k}),(0,n.jsxs)("div",{className:"vmf-folder-modal-actions",children:[(0,n.jsx)(o.Button,{variant:"secondary",onClick:()=>c(!1),disabled:F,children:(0,a.__)("Cancel","virtual-media-folders")}),(0,n.jsx)(o.Button,{variant:"primary",onClick:async function(){if(w.trim()){N(!0),E("");try{await l()({path:"/vmf/v1/folders",method:"POST",data:{name:w.trim(),parent:b}}),_(""),x(0),c(!1),z((0,a.__)("Folder created.","virtual-media-folders"),"success"),i?.()}catch(e){E(e.message||(0,a.__)("Failed to create folder.","virtual-media-folders"))}finally{N(!1)}}else E((0,a.__)("Please enter a folder name.","virtual-media-folders"))},disabled:F,children:F?(0,a.__)("Creating…","virtual-media-folders"):(0,a.__)("Create","virtual-media-folders")})]})]}),f&&(0,n.jsxs)(o.Modal,{title:(0,a.__)("Edit Folder","virtual-media-folders"),onRequestClose:()=>p(!1),className:"vmf-folder-modal",children:[(0,n.jsx)(o.TextControl,{label:(0,a.__)("Folder Name","virtual-media-folders"),value:y,onChange:j,placeholder:(0,a.__)("Enter folder name","virtual-media-folders"),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}),(0,n.jsx)(o.SelectControl,{label:(0,a.__)("Parent Folder","virtual-media-folders"),value:String(S),options:[{label:(0,a.__)("None (top level)","virtual-media-folders"),value:"0"},...T(e,0,0,r)],onChange:e=>C(parseInt(e,10)),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}),k&&(0,n.jsx)("p",{className:"vmf-folder-modal-error",children:k}),(0,n.jsxs)("div",{className:"vmf-folder-modal-actions",children:[(0,n.jsx)(o.Button,{variant:"secondary",onClick:()=>p(!1),disabled:F,children:(0,a.__)("Cancel","virtual-media-folders")}),(0,n.jsx)(o.Button,{variant:"primary",onClick:async function(){if(y.trim()){if(r&&"number"==typeof r){N(!0),E("");try{await l()({path:`/vmf/v1/folders/${r}`,method:"PUT",data:{name:y.trim(),parent:S}}),j(""),C(0),p(!1),z((0,a.__)("Folder updated.","virtual-media-folders"),"success"),i?.()}catch(e){E(e.message||(0,a.__)("Failed to update folder.","virtual-media-folders"))}finally{N(!1)}}}else E((0,a.__)("Please enter a folder name.","virtual-media-folders"))},disabled:F,children:F?(0,a.__)("Saving…","virtual-media-folders"):(0,a.__)("Save","virtual-media-folders")})]})]}),h&&(0,n.jsxs)(o.Modal,{title:(0,a.__)("Delete Folder","virtual-media-folders"),onRequestClose:()=>g(!1),className:"vmf-folder-modal",children:[(0,n.jsx)("p",{children:(0,a.sprintf)(/* translators: %s: folder name */ /* translators: %s: folder name */
(0,a.__)('Are you sure you want to delete the folder "%s"?',"virtual-media-folders"),$?.name||"")}),(0,n.jsx)("p",{className:"vmf-folder-modal-warning",children:(0,a.__)("Media items in this folder will not be deleted, only the folder organization.","virtual-media-folders")}),k&&(0,n.jsx)("p",{className:"vmf-folder-modal-error",children:k}),(0,n.jsxs)("div",{className:"vmf-folder-modal-actions",children:[(0,n.jsx)(o.Button,{variant:"secondary",onClick:()=>g(!1),disabled:F,children:(0,a.__)("Cancel","virtual-media-folders")}),(0,n.jsx)(o.Button,{variant:"primary",isDestructive:!0,onClick:async function(){if(r&&"number"==typeof r){N(!0),E("");try{await l()({path:`/vmf/v1/folders/${r}`,method:"DELETE"}),g(!1),z((0,a.__)("Folder deleted.","virtual-media-folders"),"success"),d?.(),i?.()}catch(e){E(e.message||(0,a.__)("Failed to delete folder.","virtual-media-folders"))}finally{N(!1)}}},disabled:F,children:F?(0,a.__)("Deleting…","virtual-media-folders"):(0,a.__)("Delete","virtual-media-folders")})]})]})]})}function h({onComplete:e}){const[o,r]=(0,t.useState)([]),[i,d]=(0,t.useState)(""),[s,c]=(0,t.useState)(!1),[f,m]=(0,t.useState)(0),u=(0,t.useCallback)(async()=>{try{const e=await l()({path:"/wp/v2/media-folders?per_page=100"});r(e)}catch(e){console.error("Error fetching folders:",e)}},[]);function v(e,t="success"){const o=document.createElement("div");o.className=`notice notice-${t} vmf-notice is-dismissible`,o.innerHTML=`<p>${e}</p>`,o.style.cssText="position: fixed; top: 40px; right: 20px; z-index: 100000; max-width: 300px;",document.body.appendChild(o),setTimeout(()=>o.remove(),3e3)}return(0,t.useEffect)(()=>{u();const e=()=>{u()};return window.addEventListener("vmf:folders-updated",e),()=>{window.removeEventListener("vmf:folders-updated",e)}},[u]),(0,t.useEffect)(()=>{function e(){const e=document.querySelectorAll(".attachment.selected, .attachment.details");m(e.length)}e();const t=new MutationObserver(e),o=document.querySelector(".attachments");return o&&t.observe(o,{attributes:!0,attributeFilter:["class"],subtree:!0}),document.addEventListener("click",e),()=>{t.disconnect(),document.removeEventListener("click",e)}},[]),0===f?null:(0,n.jsxs)("div",{className:"vmf-bulk-folder-action",children:[(0,n.jsxs)("select",{value:i,onChange:e=>d(e.target.value),disabled:s,className:"vmf-bulk-folder-select",children:[(0,n.jsx)("option",{value:"",children:(0,a.__)("Move to folder…","virtual-media-folders")}),(0,n.jsx)("option",{value:"uncategorized",children:(0,a.__)("Uncategorized","virtual-media-folders")}),o.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,n.jsx)("button",{type:"button",className:"button vmf-bulk-folder-apply",onClick:async function(){if(!i)return;const t=function(){const e=document.querySelectorAll(".attachment.selected, .attachment.details"),t=[];return e.forEach(e=>{const o=e.getAttribute("data-id");o&&t.push(parseInt(o,10))}),t}();if(0===t.length)return;c(!0);const{ajaxUrl:r,nonce:l}=window.vmfData||{};try{const n=t.map(async e=>{const t=new FormData;return t.append("action","vmf_move_to_folder"),t.append("nonce",l),t.append("media_id",e),t.append("folder_id",i),(await fetch(r,{method:"POST",credentials:"same-origin",body:t})).json()});await Promise.all(n);const d="uncategorized"===i?(0,a.__)("Uncategorized","virtual-media-folders"):o.find(e=>e.id===parseInt(i,10))?.name||"";v((0,a.sprintf)(/* translators: 1: number of items, 2: folder name */ /* translators: 1: number of items, 2: folder name */
(0,a.__)('%1$d items moved to "%2$s".',"virtual-media-folders"),t.length,d),"success"),window.vmfRefreshFolders&&window.vmfRefreshFolders();const{jumpToFolderAfterMove:s=!1}=window.vmfData||{};s?setTimeout(()=>{if(window.vmfSelectFolder){const e="uncategorized"===i?"uncategorized":parseInt(i,10);window.vmfSelectFolder(e)}},200):!document.querySelector(".attachments-browser")?.classList.contains("vmf-folder-filtered")||t.forEach(e=>{const t=document.querySelector(`.attachment[data-id="${e}"]`);t&&t.remove()});const c=document.querySelector(".select-mode-toggle-button");c&&c.click(),e?.()}catch(e){console.error("Bulk move error:",e),v((0,a.__)("Failed to move some items.","virtual-media-folders"),"error")}finally{c(!1),d("")}},disabled:!i||s,title:s?(0,a.__)("Moving…","virtual-media-folders"):(0,a.__)("Apply","virtual-media-folders"),"aria-label":s?(0,a.__)("Moving…","virtual-media-folders"):(0,a.__)("Apply","virtual-media-folders"),children:s?(0,n.jsx)("span",{className:"spinner is-active",style:{margin:0}}):(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"20",height:"20",fill:"currentColor","aria-hidden":"true",children:(0,n.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})})}),(0,n.jsx)("span",{className:"vmf-bulk-folder-count",children:(0,a.sprintf)(/* translators: %d: number of selected items */ /* translators: %d: number of selected items */
(0,a.__)("%d selected","virtual-media-folders"),f)})]})}const{showAllMedia:g=!0,showUncategorized:w=!0}=window.vmfData||{},_=g?null:"uncategorized";function b({onFolderSelect:e}){const[o,a]=(0,t.useState)(""),{folders:r,flatFolders:i,selectedId:d,setSelectedId:f,loading:m,uncategorizedCount:u,fetchFolders:v,handleSelect:b}=function({trackUrl:e=!1,onFolderSelect:o,mediaType:a="",defaultFolder:r=null}={}){const[n,i]=(0,t.useState)([]),[d,s]=(0,t.useState)([]),[c,f]=(0,t.useState)(r),[m,u]=(0,t.useState)(!0),[v,p]=(0,t.useState)(0),h=(0,t.useCallback)(async(e=a)=>{try{const t=await l()({path:"/wp/v2/media-folders?per_page=100&hierarchical=1"});let o=null;e&&(o=await l()({path:`/vmf/v1/folders/counts?media_type=${encodeURIComponent(e)}`}));const a=t.map(e=>({...e,count:o?o[e.id]||0:e.count}));s(a);const r=function(e){const t={},o=[];return e.forEach(e=>{t[e.id]={...e,children:[]}}),e.forEach(e=>{e.parent&&t[e.parent]?t[e.parent].children.push(t[e.id]):o.push(t[e.id])}),o}(a);i(r);const n=function(e){if(!e||"all"===e)return"";if(e.includes("/")||e.includes(",")){const t=e.split(",")[0].split("/")[0];return["image","video","audio","application","text"].includes(t)?t:""}return e}(e);let d="/wp/v2/media?per_page=1";n&&(d+=`&media_type=${encodeURIComponent(n)}`);const c=await l()({path:d,parse:!1}),f=parseInt(c.headers.get("X-WP-Total"),10)||0;let m=0;a.forEach(e=>{m+=e.count||0}),p(Math.max(0,f-m))}catch(e){console.error("Error fetching folders:",e)}finally{u(!1)}},[a]);(0,t.useEffect)(()=>{if(e){const e=new URLSearchParams(window.location.search),t=e.get("vmf_folder"),o=e.get("mode");t?f("uncategorized"===t?"uncategorized":parseInt(t,10)):"folder"===o&&f(r)}h()},[h,e,r]),(0,t.useEffect)(()=>{void 0!==a&&h(a)},[a,h]);const g=(0,t.useCallback)(e=>{f(e),o?.(e)},[o]);return{folders:n,flatFolders:d,selectedId:c,setSelectedId:f,loading:m,uncategorizedCount:v,fetchFolders:h,handleSelect:g}}({trackUrl:!0,onFolderSelect:e,mediaType:o,defaultFolder:_});(0,t.useEffect)(()=>{function e(){const e=document.querySelector('select.attachment-filters[id="media-attachment-filters"], select.attachment-filters[id*="media-attachment"]');if(e){const t=e.value;return"all"===t?"":t}return""}function t(e){if(e.target.matches("select.attachment-filters")&&("media-attachment-filters"===e.target.id||e.target.id.includes("media-attachment"))){const t=e.target.value;a("all"===t?"":t)}}if(a(e()),document.addEventListener("change",t),"undefined"!=typeof wp&&wp.media&&wp.media.frame){const t=wp.media.frame;if(t.content&&t.content.get){const o=t.content.get();o&&o.collection&&o.collection.on("change:type",()=>{a(e())})}}return()=>{document.removeEventListener("change",t)}},[]);const x=(0,t.useCallback)(e=>{b(e)},[b]),y=(0,t.useCallback)(()=>{const t=u>0?"uncategorized":null;f(t),e?.(t)},[u,f,e]),j=(0,t.useCallback)(()=>{v(),window.dispatchEvent(new CustomEvent("vmf:folders-updated"))},[v]);(0,t.useEffect)(()=>(window.vmfRefreshFolders=j,window.vmfSelectFolder=t=>{f(t),e?.(t)},()=>{delete window.vmfRefreshFolders,delete window.vmfSelectFolder}),[j,e,f]);const S=(0,t.useCallback)(({folderId:e,children:t})=>(0,n.jsx)(c,{folderId:e,children:t}),[]),C=(0,t.useCallback)(({children:e})=>(0,n.jsx)(c,{folderId:"uncategorized",children:e}),[]),F=(0,t.useCallback)(()=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(p,{folders:i,selectedId:d,onRefresh:j,onDelete:y}),(0,n.jsx)(h,{onComplete:j})]}),[i,d,j,y]);return(0,n.jsx)(s,{folders:r,selectedId:d,onSelect:x,uncategorizedCount:u,showAllMedia:g,showUncategorized:w,loading:m,renderWrapper:S,renderUncategorizedWrapper:C,renderHeader:F,enableKeyboardNav:!0,enableAutoExpand:!0,enableAria:!0,loadingText:"Loading folders…"})}let x=!1,y=null,j=null;function S(e,t="success"){const o=document.createElement("div");o.className=`notice notice-${t} vmf-notice is-dismissible`,o.innerHTML=`<p>${e}</p>`,o.style.cssText="position: fixed; top: 40px; right: 20px; z-index: 100000; max-width: 300px;",document.body.appendChild(o),setTimeout(()=>o.remove(),3e3)}function C(){jQuery(".view-switch a").removeClass("current")}function F(e,t){x=t;const o=e.$el.find("#vmf-folder-tree"),a=jQuery(".vmf-folder-toggle-button");t?(o.addClass("is-visible"),a.addClass("is-active"),document.body.classList.add("vmf-folder-view-active"),e.$el.addClass("vmf-sidebar-visible"),C(),setTimeout(C,100),setTimeout(C,500),function(e){const t=e.$el.find(".attachments");function o(){t.find('.attachment:not([draggable="true"])').each(function(){const e=jQuery(this);e.attr("draggable","true");const t=e.data("id");t&&e.data("attachment-id",t)})}t.length&&(o(),new MutationObserver(o).observe(t[0],{childList:!0,subtree:!0}),t.off("dragstart.mm dragend.mm"),t.on("dragstart.mm",".attachment",function(e){const t=jQuery(this);let o=t.data("attachment-id")||t.data("id");if(!o){const e=t.attr("aria-label");if(e){const t=e.match(/id[:\s]+(\d+)/i);t&&(o=parseInt(t[1],10))}}o&&(e.originalEvent.dataTransfer.setData("text/plain",JSON.stringify({mediaId:o,title:t.find(".filename").text()||"",thumbnail:t.find("img").attr("src")||""})),e.originalEvent.dataTransfer.effectAllowed="move",t.addClass("vmf-dragging"),document.body.classList.add("vmf-internal-drag"))}),t.on("dragend.mm",".attachment",function(){jQuery(this).removeClass("vmf-dragging"),document.body.classList.remove("vmf-internal-drag")}))}(e),function(e){const t=()=>{const o=document.querySelector(".vmf-folder-tree-sidebar"),a=e.$el.find(".attachments-wrapper")[0],r=e.$el.find(".attachments")[0];if(!o)return void setTimeout(t,100);if(!a||!r)return;let l=!1;function n(){const e=window.getComputedStyle(r),t=parseInt(e.paddingTop,10)||0;return(r.offsetTop||0)+t+8}let i=n();function d(){i=n(),i<0&&(i=0),c()}setTimeout(d,100),setTimeout(d,300),setTimeout(d,600);const s=e.$el.find(".uploader-inline")[0];function c(){const e=r.getBoundingClientRect().top,t=a.getBoundingClientRect();e>=32?(o.style.position="absolute",o.style.top="0",o.style.left="0",o.style.transform=`translateY(${i}px)`):(o.style.position="fixed",o.style.top="32px",o.style.left=`${t.left}px`,o.style.transform="translateY(0)"),l=!1}function f(){l||(requestAnimationFrame(c),l=!0)}function m(){d()}s&&new MutationObserver(()=>{setTimeout(d,50)}).observe(s,{attributes:!0,attributeFilter:["style","class"]}),window.addEventListener("scroll",f,{passive:!0}),window.addEventListener("resize",m,{passive:!0}),c(),o._recalculateOffset=d,o._cleanupSticky=()=>{window.removeEventListener("scroll",f),window.removeEventListener("resize",m)}};t()}(e)):(o.removeClass("is-visible"),a.removeClass("is-active"),document.body.classList.remove("vmf-folder-view-active"),e.$el.removeClass("vmf-sidebar-visible"),jQuery(".view-switch a.view-grid").addClass("current")),localStorage.setItem("vmf_folder_view",t?"1":"0")}function N(){if("undefined"==typeof wp||void 0===wp.media)return;const e=wp.media.view.AttachmentsBrowser.prototype.render;wp.media.view.AttachmentsBrowser.prototype.render=function(){const r=e.apply(this,arguments);return function(e){if(e.$el.find("#vmf-folder-tree").length)return;const r=document.createElement("div");r.id="vmf-folder-tree",r.className="vmf-folder-tree-sidebar";const l=e.$el.find(".attachments-wrapper").first(),i=e.$el;l.length?l.prepend(r):i.prepend(r),y=(0,t.createRoot)(r),y.render((0,n.jsxs)(o.SlotFillProvider,{children:[(0,n.jsx)(b,{onFolderSelect:t=>{const o=new URL(window.location);t?o.searchParams.set("vmf_folder",t):o.searchParams.delete("vmf_folder"),o.searchParams.set("mode","folder"),window.history.pushState({},"",o);const a=e.collection;if(a){const o=a.props.get("orderby")||"date",r=a.props.get("order")||"DESC",l=e.$el.find(".attachments");l.addClass("vmf-loading");const n=e.$el.hasClass("vmf-folder-filtered"),i=null!==t;if(i?e.$el.addClass("vmf-folder-filtered"):e.$el.removeClass("vmf-folder-filtered"),n!==i){const e=document.querySelector(".vmf-folder-tree-sidebar");e&&e._recalculateOffset&&setTimeout(()=>e._recalculateOffset(),50)}a.props.unset("media_folder"),a.props.unset("media_folder_exclude"),"uncategorized"===t?a.props.set({media_folder_exclude:"all",orderby:o,order:r}):t?a.props.set({media_folder:t,orderby:o,order:r}):a.props.set({orderby:o,order:r}),a.reset(),a.more({remove:!1}).then(()=>{l.removeClass("vmf-loading")}).catch(()=>{l.removeClass("vmf-loading")})}}}),(0,n.jsx)(o.Popover.Slot,{})]})),function(e){if(j=e,!jQuery(".vmf-folder-toggle-button").length){const t='<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" aria-hidden="true" focusable="false"><path d="M4 5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-7.5l-2-2H4z"/></svg>',o=e.$el.find(".media-toolbar-secondary");if(o.length){const r=jQuery(`\n\t\t\t\t<button type="button" class="vmf-folder-toggle-button" title="${(0,a.__)("Show Folders","virtual-media-folders")}">\n\t\t\t\t\t<span class="screen-reader-text">${(0,a.__)("Show Folders","virtual-media-folders")}</span>\n\t\t\t\t\t${t}\n\t\t\t\t</button>\n\t\t\t`);o.prepend(r),r.on("click",t=>{t.preventDefault(),F(e,!0)})}}const t=localStorage.getItem("vmf_folder_view"),o=new URLSearchParams(window.location.search);("1"===t||o.has("vmf_folder")||"folder"===o.get("mode"))&&F(e,!0)}(e)}(this),r}}jQuery(document).on("click",".view-switch a",function(){!function(){x=!1,localStorage.setItem("vmf_folder_view","0");const e=jQuery("#vmf-folder-tree"),t=jQuery(".vmf-folder-toggle-button");e.removeClass("is-visible"),t.removeClass("is-active"),document.body.classList.remove("vmf-folder-view-active"),jQuery(".attachments-browser").removeClass("vmf-sidebar-visible")}()}),jQuery(document).on("click",".page-title-action",function(){jQuery(".attachments-browser").hasClass("vmf-folder-filtered")&&"function"==typeof window.vmfSelectFolder&&window.vmfSelectFolder(null)}),jQuery(document).ready(function(){!function(){const e=localStorage.getItem("vmf_folder_view"),t=new URLSearchParams(window.location.search);let o=t.has("vmf_folder")||"folder"===t.get("mode");o||null===e||(o="1"===e);const r=jQuery(".vmf-folder-toggle-button");if(r.length)return void(o&&r.addClass("is-active"));const l=jQuery(".view-switch");if(l.length){const e=jQuery(`\n\t\t\t<a href="#" class="vmf-folder-toggle-button${o?" is-active":""}" title="${(0,a.__)("Show Folders","virtual-media-folders")}">\n\t\t\t\t<span class="screen-reader-text">${(0,a.__)("Show Folders","virtual-media-folders")}</span>\n\t\t\t\t<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" aria-hidden="true" focusable="false"><path d="M4 5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-7.5l-2-2H4z"/></svg>\n\t\t\t</a>\n\t\t`);l.before(e),e.on("click",t=>{if(t.preventDefault(),"list"===new URLSearchParams(window.location.search).get("mode"))return localStorage.setItem("vmf_folder_view","1"),void(window.location.href=window.location.pathname+"?mode=grid");j?F(j,!0):(localStorage.setItem("vmf_folder_view","1"),x=!0,e.addClass("is-active"))})}}()}),window.vmfMoveToFolder=async function(e,t){const{ajaxUrl:o,nonce:r}=window.vmfData||{};if(!o||!r)return void console.error("Virtual Media Folders: Missing AJAX configuration");const l=new FormData;l.append("action","vmf_move_to_folder"),l.append("nonce",r),l.append("media_id",e),l.append("folder_id",null!=t?t:"");try{const e=await fetch(o,{method:"POST",credentials:"same-origin",body:l}),t=await e.json();t.success?(t.data?.message&&S(t.data.message,"success"),window.vmfRefreshFolders&&window.vmfRefreshFolders(),function(){if(!document.querySelector(".attachments-browser")?.classList.contains("vmf-folder-filtered"))return;const e=jQuery(".vmf-folder-button.is-selected");if(e.length)setTimeout(()=>{e.trigger("click")},100);else try{if(wp.media?.frame?.content?.get){const e=wp.media.frame.content.get();if(e&&e.collection){const t=e.collection.props.get("orderby")||"date",o=e.collection.props.get("order")||"DESC";e.collection.reset(),e.collection.props.set({orderby:t,order:o}),e.collection.more({remove:!1})}}}catch(e){console.error("Error refreshing media library:",e)}}()):S(t.data?.message||(0,a.__)("Failed to move media.","virtual-media-folders"),"error")}catch(e){console.error("Error moving media:",e),S((0,a.__)("Failed to move media.","virtual-media-folders"),"error")}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",N):N()})();