(()=>{"use strict";var e={n:a=>{var t=a&&a.__esModule?()=>a.default:()=>a;return e.d(t,{a:t}),t},d:(a,t)=>{for(var n in t)e.o(t,n)&&!e.o(a,n)&&Object.defineProperty(a,n,{enumerable:!0,get:t[n]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a)};const a=window.wp.element,t=window.wp.components,n=window.wp.i18n,r=window.wp.apiFetch;var o=e.n(r);const i=window.ReactJSXRuntime;function l({expanded:e}){return(0,i.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e?(0,i.jsx)("polyline",{points:"6 9 12 15 18 9"}):(0,i.jsx)("polyline",{points:"9 6 15 12 9 18"})})}function d({folder:e,selectedId:t,onSelect:r,level:o=0,renderWrapper:s,enableKeyboardNav:m=!1,enableAutoExpand:c=!1,enableAria:u=!1}){const f=e=>!(!e.children||0===e.children.length)&&e.children.some(e=>e.id===t||f(e)),p=c&&f(e),[g,h]=(0,a.useState)(p),v=g||p,w=e.children&&e.children.length>0,_=t===e.id;(0,a.useEffect)(()=>{p&&!g&&h(!0)},[p,g]);const x=(0,i.jsxs)("button",{type:"button",className:"mm-folder-button "+(_?"is-selected":""),style:{paddingLeft:16*o+8+"px"},onClick:()=>r(e.id),onKeyDown:m?a=>{m&&("ArrowRight"===a.key&&w&&!v?(a.preventDefault(),h(!0)):"ArrowLeft"===a.key&&w&&v?(a.preventDefault(),h(!1)):"Enter"!==a.key&&" "!==a.key||(a.preventDefault(),r(e.id)))}:void 0,"aria-current":_?"true":void 0,title:e.name,children:[w&&(0,i.jsx)("span",{className:"mm-folder-toggle",onClick:e=>{e.stopPropagation(),h(!v)},onKeyDown:m?e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),h(!v))}:void 0,role:m?"button":void 0,tabIndex:m?0:void 0,"aria-label":v?(0,n.__)("Collapse","mediamanager"):(0,n.__)("Expand","mediamanager"),children:(0,i.jsx)(l,{expanded:v})}),(0,i.jsx)("span",{className:"mm-folder-name",children:e.name}),"number"==typeof e.count&&(0,i.jsxs)("span",{className:"mm-folder-count","aria-label":u?`${e.count} ${(0,n.__)("items","mediamanager")}`:void 0,children:["(",e.count,")"]})]}),b=s?s({folderId:e.id,children:x}):x,y=u?{role:"treeitem","aria-expanded":w?v:void 0,"aria-selected":_}:{};return(0,i.jsxs)("li",{className:"mm-folder-item",...y,children:[b,w&&v&&(0,i.jsx)("ul",{className:"mm-folder-children",role:u?"group":void 0,children:e.children.map(e=>(0,i.jsx)(d,{folder:e,selectedId:t,onSelect:r,level:o+1,renderWrapper:s,enableKeyboardNav:m,enableAutoExpand:c,enableAria:u},e.id))})]})}function s({folders:e,selectedId:a,onSelect:t,uncategorizedCount:r,loading:o,renderWrapper:l,renderUncategorizedWrapper:s,renderHeader:m,enableKeyboardNav:c=!1,enableAutoExpand:u=!1,enableAria:f=!1,className:p="",loadingText:g}){if(o){const e=f?"mm-folder-tree":"mm-folder-sidebar";return(0,i.jsx)("div",{className:`${e} ${e}--loading ${p}`,"aria-label":f?(0,n.__)("Media folders","mediamanager"):void 0,children:(0,i.jsx)("p",{"aria-live":f?"polite":void 0,children:g||(0,n.__)("Loading…","mediamanager")})})}const h=(0,i.jsx)("button",{type:"button",className:"mm-folder-button "+(null===a?"is-selected":""),onClick:()=>t(null),"aria-current":null===a?"true":void 0,children:(0,i.jsx)("span",{className:"mm-folder-name",children:(0,n.__)("All Media","mediamanager")})}),v=(0,i.jsxs)("button",{type:"button",className:"mm-folder-button "+("uncategorized"===a?"is-selected":""),onClick:()=>t("uncategorized"),"aria-current":"uncategorized"===a?"true":void 0,children:[(0,i.jsx)("span",{className:"mm-folder-name",children:(0,n.__)("Uncategorized","mediamanager")}),(0,i.jsxs)("span",{className:"mm-folder-count","aria-label":f?`${r} ${(0,n.__)("items","mediamanager")}`:void 0,children:["(",r,")"]})]}),w=s?s({children:v}):v,_=f?"nav":"div",x=f?"mm-folder-tree":"mm-folder-sidebar";return(0,i.jsxs)(_,{className:`${x} ${p}`,"aria-label":f?(0,n.__)("Media folders","mediamanager"):void 0,children:[m&&m(),(0,i.jsxs)("ul",{className:"mm-folder-list",role:f?"tree":void 0,"aria-label":f?(0,n.__)("Folder tree","mediamanager"):void 0,children:[(0,i.jsx)("li",{className:"mm-folder-item",role:f?"treeitem":void 0,"aria-selected":f?null===a:void 0,children:h}),(0,i.jsx)("li",{className:"mm-folder-item",role:f?"treeitem":void 0,"aria-selected":f?"uncategorized"===a:void 0,children:w}),e.map(e=>(0,i.jsx)(d,{folder:e,selectedId:a,onSelect:t,renderWrapper:l,enableKeyboardNav:c,enableAutoExpand:u,enableAria:f},e.id))]})]})}function m({folderId:e,children:t,className:r=""}){const[o,l]=(0,a.useState)(!1),d=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),l(!0)},[]),s=(0,a.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),l(!1)},[]),m=(0,a.useCallback)(a=>{a.preventDefault(),a.stopPropagation(),l(!1);try{const t=a.dataTransfer.getData("text/plain");if(!t)return;const n=JSON.parse(t);n.mediaId&&window.mediaManagerMoveToFolder&&(window.mediaManagerMoveToFolder(n.mediaId,e),window.mediaManagerSelectFolder&&setTimeout(()=>{window.mediaManagerSelectFolder(e)},200))}catch(e){}},[e]);return(0,i.jsxs)("div",{className:`mm-droppable-folder ${r} ${o?"is-over":""}`,onDragOver:d,onDragEnter:d,onDragLeave:s,onDrop:m,children:[t,o&&(0,i.jsx)("span",{className:"screen-reader-text",children:(0,n.__)("Drop here to move media to this folder","mediamanager")})]})}(0,a.createContext)(null);const c=window.wp.primitives;var u=(0,i.jsx)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,i.jsx)(c.Path,{d:"M11 12.5V17.5H12.5V12.5H17.5V11H12.5V6H11V11H6V12.5H11Z"})}),f=(0,i.jsx)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,i.jsx)(c.Path,{d:"m19 7-3-3-8.5 8.5-1 4 4-1L19 7Zm-7 11.5H5V20h7v-1.5Z"})}),p=(0,i.jsx)(c.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,i.jsx)(c.Path,{fillRule:"evenodd",clipRule:"evenodd",d:"M12 5.5A2.25 2.25 0 0 0 9.878 7h4.244A2.251 2.251 0 0 0 12 5.5ZM12 4a3.751 3.751 0 0 0-3.675 3H5v1.5h1.27l.818 8.997a2.75 2.75 0 0 0 2.739 2.501h4.347a2.75 2.75 0 0 0 2.738-2.5L17.73 8.5H19V7h-3.325A3.751 3.751 0 0 0 12 4Zm4.224 4.5H7.776l.806 8.861a1.25 1.25 0 0 0 1.245 1.137h4.347a1.25 1.25 0 0 0 1.245-1.137l.805-8.861Z"})});function g({folders:e=[],selectedId:r,onRefresh:l,onDelete:d}){const[s,m]=(0,a.useState)(!1),[c,g]=(0,a.useState)(!1),[h,v]=(0,a.useState)(!1),[w,_]=(0,a.useState)(""),[x,b]=(0,a.useState)(0),[y,j]=(0,a.useState)(""),[C,S]=(0,a.useState)(!1),[N,F]=(0,a.useState)(""),M=e.find(e=>e.id===r);function k(e,a="success"){const t=document.createElement("div");t.className=`notice notice-${a} mm-notice is-dismissible`,t.innerHTML=`<p>${e}</p>`,t.style.cssText="position: fixed; top: 40px; right: 20px; z-index: 100000; max-width: 300px;",document.body.appendChild(t),setTimeout(()=>t.remove(),3e3)}const $=r&&"number"==typeof r;return(0,i.jsxs)("div",{className:"mm-folder-manager",onClick:e=>e.stopPropagation(),children:[(0,i.jsxs)("div",{className:"mm-folder-manager-buttons",children:[(0,i.jsx)(t.Button,{icon:u,"aria-label":(0,n.__)("Create Folder","mediamanager"),onClick:a=>{a.stopPropagation(),F("");const t=e.some(e=>e.id===r);b(t?r:0),m(!0)},className:"mm-folder-manager-button",size:"small",showTooltip:!1}),(0,i.jsx)(t.Button,{icon:f,"aria-label":(0,n.__)("Rename Folder","mediamanager"),onClick:e=>{e.stopPropagation(),M&&(j(M.name),F(""),g(!0))},disabled:!$,className:"mm-folder-manager-button",size:"small",showTooltip:!1}),(0,i.jsx)(t.Button,{icon:p,"aria-label":(0,n.__)("Delete Folder","mediamanager"),onClick:e=>{e.stopPropagation(),F(""),v(!0)},disabled:!$,className:"mm-folder-manager-button",isDestructive:!0,size:"small",showTooltip:!1})]}),s&&(0,i.jsxs)(t.Modal,{title:(0,n.__)("Create Folder","mediamanager"),onRequestClose:()=>m(!1),className:"mm-folder-modal",children:[(0,i.jsx)(t.TextControl,{label:(0,n.__)("Folder Name","mediamanager"),value:w,onChange:_,placeholder:(0,n.__)("Enter folder name","mediamanager"),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}),(0,i.jsx)(t.SelectControl,{label:(0,n.__)("Parent Folder","mediamanager"),value:String(x),options:[{label:(0,n.__)("None (top level)","mediamanager"),value:"0"},...function e(a,t=0,n=0,r=null){let o=[];const i=a.filter(e=>e.parent===t);for(const t of i){if(null!==r&&t.id===r)continue;const i=n>0?"— ".repeat(n):"";o.push({label:i+t.name,value:String(t.id)}),o=o.concat(e(a,t.id,n+1,r))}return o}(e)],onChange:e=>b(parseInt(e,10)),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}),N&&(0,i.jsx)("p",{className:"mm-folder-modal-error",children:N}),(0,i.jsxs)("div",{className:"mm-folder-modal-actions",children:[(0,i.jsx)(t.Button,{variant:"secondary",onClick:()=>m(!1),disabled:C,children:(0,n.__)("Cancel","mediamanager")}),(0,i.jsx)(t.Button,{variant:"primary",onClick:async function(){if(w.trim()){S(!0),F("");try{await o()({path:"/mediamanager/v1/folders",method:"POST",data:{name:w.trim(),parent:x}}),_(""),b(0),m(!1),k((0,n.__)("Folder created.","mediamanager"),"success"),l?.()}catch(e){F(e.message||(0,n.__)("Failed to create folder.","mediamanager"))}finally{S(!1)}}else F((0,n.__)("Please enter a folder name.","mediamanager"))},disabled:C,children:C?(0,n.__)("Creating…","mediamanager"):(0,n.__)("Create","mediamanager")})]})]}),c&&(0,i.jsxs)(t.Modal,{title:(0,n.__)("Rename Folder","mediamanager"),onRequestClose:()=>g(!1),className:"mm-folder-modal",children:[(0,i.jsx)(t.TextControl,{label:(0,n.__)("New Name","mediamanager"),value:y,onChange:j,placeholder:(0,n.__)("Enter new name","mediamanager"),__next40pxDefaultSize:!0,__nextHasNoMarginBottom:!0}),N&&(0,i.jsx)("p",{className:"mm-folder-modal-error",children:N}),(0,i.jsxs)("div",{className:"mm-folder-modal-actions",children:[(0,i.jsx)(t.Button,{variant:"secondary",onClick:()=>g(!1),disabled:C,children:(0,n.__)("Cancel","mediamanager")}),(0,i.jsx)(t.Button,{variant:"primary",onClick:async function(){if(y.trim()){if(r&&"number"==typeof r){S(!0),F("");try{await o()({path:`/mediamanager/v1/folders/${r}`,method:"PUT",data:{name:y.trim()}}),j(""),g(!1),k((0,n.__)("Folder renamed.","mediamanager"),"success"),l?.()}catch(e){F(e.message||(0,n.__)("Failed to rename folder.","mediamanager"))}finally{S(!1)}}}else F((0,n.__)("Please enter a folder name.","mediamanager"))},disabled:C,children:C?(0,n.__)("Renaming…","mediamanager"):(0,n.__)("Rename","mediamanager")})]})]}),h&&(0,i.jsxs)(t.Modal,{title:(0,n.__)("Delete Folder","mediamanager"),onRequestClose:()=>v(!1),className:"mm-folder-modal",children:[(0,i.jsx)("p",{children:(0,n.sprintf)(/* translators: %s: folder name */ /* translators: %s: folder name */
(0,n.__)('Are you sure you want to delete the folder "%s"?',"mediamanager"),M?.name||"")}),(0,i.jsx)("p",{className:"mm-folder-modal-warning",children:(0,n.__)("Media items in this folder will not be deleted, only the folder organization.","mediamanager")}),N&&(0,i.jsx)("p",{className:"mm-folder-modal-error",children:N}),(0,i.jsxs)("div",{className:"mm-folder-modal-actions",children:[(0,i.jsx)(t.Button,{variant:"secondary",onClick:()=>v(!1),disabled:C,children:(0,n.__)("Cancel","mediamanager")}),(0,i.jsx)(t.Button,{variant:"primary",isDestructive:!0,onClick:async function(){if(r&&"number"==typeof r){S(!0),F("");try{await o()({path:`/mediamanager/v1/folders/${r}`,method:"DELETE"}),v(!1),k((0,n.__)("Folder deleted.","mediamanager"),"success"),d?.(),l?.()}catch(e){F(e.message||(0,n.__)("Failed to delete folder.","mediamanager"))}finally{S(!1)}}},disabled:C,children:C?(0,n.__)("Deleting…","mediamanager"):(0,n.__)("Delete","mediamanager")})]})]})]})}function h({onComplete:e}){const[t,r]=(0,a.useState)([]),[l,d]=(0,a.useState)(""),[s,m]=(0,a.useState)(!1),[c,u]=(0,a.useState)(0);function f(e,a="success"){const t=document.createElement("div");t.className=`notice notice-${a} mm-notice is-dismissible`,t.innerHTML=`<p>${e}</p>`,t.style.cssText="position: fixed; top: 40px; right: 20px; z-index: 100000; max-width: 300px;",document.body.appendChild(t),setTimeout(()=>t.remove(),3e3)}return(0,a.useEffect)(()=>{!async function(){try{const e=await o()({path:"/wp/v2/media-folders?per_page=100"});r(e)}catch(e){console.error("Error fetching folders:",e)}}()},[]),(0,a.useEffect)(()=>{function e(){const e=document.querySelectorAll(".attachment.selected, .attachment.details");u(e.length)}e();const a=new MutationObserver(e),t=document.querySelector(".attachments");return t&&a.observe(t,{attributes:!0,attributeFilter:["class"],subtree:!0}),document.addEventListener("click",e),()=>{a.disconnect(),document.removeEventListener("click",e)}},[]),0===c?null:(0,i.jsxs)("div",{className:"mm-bulk-folder-action",children:[(0,i.jsxs)("select",{value:l,onChange:e=>d(e.target.value),disabled:s,className:"mm-bulk-folder-select",children:[(0,i.jsx)("option",{value:"",children:(0,n.__)("Move to folder…","mediamanager")}),(0,i.jsx)("option",{value:"uncategorized",children:(0,n.__)("Uncategorized","mediamanager")}),t.map(e=>(0,i.jsx)("option",{value:e.id,children:e.name},e.id))]}),(0,i.jsx)("button",{type:"button",className:"button mm-bulk-folder-apply",onClick:async function(){if(!l)return;const a=function(){const e=document.querySelectorAll(".attachment.selected, .attachment.details"),a=[];return e.forEach(e=>{const t=e.getAttribute("data-id");t&&a.push(parseInt(t,10))}),a}();if(0===a.length)return;m(!0);const{ajaxUrl:r,nonce:o}=window.mediaManagerData||{};try{const i=a.map(async e=>{const a=new FormData;return a.append("action","mm_move_to_folder"),a.append("nonce",o),a.append("media_id",e),a.append("folder_id",l),(await fetch(r,{method:"POST",credentials:"same-origin",body:a})).json()});await Promise.all(i);const d="uncategorized"===l?(0,n.__)("Uncategorized","mediamanager"):t.find(e=>e.id===parseInt(l,10))?.name||"";f((0,n.sprintf)(/* translators: 1: number of items, 2: folder name */ /* translators: 1: number of items, 2: folder name */
(0,n.__)('%1$d items moved to "%2$s".',"mediamanager"),a.length,d),"success"),window.mediaManagerRefreshFolders&&window.mediaManagerRefreshFolders(),e?.()}catch(e){console.error("Bulk move error:",e),f((0,n.__)("Failed to move some items.","mediamanager"),"error")}finally{m(!1),d("")}},disabled:!l||s,title:s?(0,n.__)("Moving…","mediamanager"):(0,n.__)("Apply","mediamanager"),"aria-label":s?(0,n.__)("Moving…","mediamanager"):(0,n.__)("Apply","mediamanager"),children:s?(0,i.jsx)("span",{className:"spinner is-active",style:{margin:0}}):(0,i.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:"20",height:"20",fill:"currentColor","aria-hidden":"true",children:(0,i.jsx)("path",{d:"M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"})})}),(0,i.jsx)("span",{className:"mm-bulk-folder-count",children:(0,n.sprintf)(/* translators: %d: number of selected items */ /* translators: %d: number of selected items */
(0,n.__)("%d selected","mediamanager"),c)})]})}function v({onFolderSelect:e}){const{folders:t,flatFolders:n,selectedId:r,setSelectedId:l,loading:d,uncategorizedCount:c,fetchFolders:u,handleSelect:f}=function({trackUrl:e=!1,onFolderSelect:t}={}){const[n,r]=(0,a.useState)([]),[i,l]=(0,a.useState)([]),[d,s]=(0,a.useState)(null),[m,c]=(0,a.useState)(!0),[u,f]=(0,a.useState)(0),p=(0,a.useCallback)(async()=>{try{const e=await o()({path:"/wp/v2/media-folders?per_page=100&hierarchical=1"});l(e);const a=function(e){const a={},t=[];return e.forEach(e=>{a[e.id]={...e,children:[]}}),e.forEach(e=>{e.parent&&a[e.parent]?a[e.parent].children.push(a[e.id]):t.push(a[e.id])}),t}(e);r(a);const t=await o()({path:"/wp/v2/media?per_page=1",parse:!1}),n=parseInt(t.headers.get("X-WP-Total"),10)||0;let i=0;e.forEach(e=>{i+=e.count||0}),f(Math.max(0,n-i))}catch(e){console.error("Error fetching folders:",e)}finally{c(!1)}},[]);(0,a.useEffect)(()=>{if(e){const e=new URLSearchParams(window.location.search).get("mm_folder");e&&s("uncategorized"===e?"uncategorized":parseInt(e,10))}p()},[p,e]);const g=(0,a.useCallback)(e=>{s(e),t?.(e)},[t]);return{folders:n,flatFolders:i,selectedId:d,setSelectedId:s,loading:m,uncategorizedCount:u,fetchFolders:p,handleSelect:g}}({trackUrl:!0,onFolderSelect:e}),p=(0,a.useCallback)(e=>{f(e)},[f]),v=(0,a.useCallback)(()=>{const a=c>0?"uncategorized":null;l(a),e?.(a)},[c,l,e]);(0,a.useEffect)(()=>(window.mediaManagerRefreshFolders=u,window.mediaManagerSelectFolder=a=>{l(a),e?.(a)},()=>{delete window.mediaManagerRefreshFolders,delete window.mediaManagerSelectFolder}),[u,e,l]);const w=(0,a.useCallback)(({folderId:e,children:a})=>(0,i.jsx)(m,{folderId:e,children:a}),[]),_=(0,a.useCallback)(({children:e})=>(0,i.jsx)(m,{folderId:"uncategorized",children:e}),[]),x=(0,a.useCallback)(()=>(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(g,{folders:n,selectedId:r,onRefresh:u,onDelete:v}),(0,i.jsx)(h,{onComplete:u})]}),[n,r,u,v]);return(0,i.jsx)(s,{folders:t,selectedId:r,onSelect:p,uncategorizedCount:c,loading:d,renderWrapper:w,renderUncategorizedWrapper:_,renderHeader:x,enableKeyboardNav:!0,enableAutoExpand:!0,enableAria:!0,loadingText:"Loading folders…"})}let w=!1,_=null,x=null;function b(e,a="success"){const t=document.createElement("div");t.className=`notice notice-${a} mm-notice is-dismissible`,t.innerHTML=`<p>${e}</p>`,t.style.cssText="position: fixed; top: 40px; right: 20px; z-index: 100000; max-width: 300px;",document.body.appendChild(t),setTimeout(()=>t.remove(),3e3)}function y(){jQuery(".view-switch a").removeClass("current")}function j(e,a){w=a;const t=e.$el.find("#mm-folder-tree"),n=jQuery(".mm-folder-toggle-button");a?(t.addClass("is-visible"),n.addClass("is-active"),document.body.classList.add("mm-folder-view-active"),e.$el.addClass("mm-sidebar-visible"),y(),setTimeout(y,100),setTimeout(y,500),function(e){const a=e.$el.find(".attachments");function t(){a.find('.attachment:not([draggable="true"])').each(function(){const e=jQuery(this);e.attr("draggable","true");const a=e.data("id");a&&e.data("attachment-id",a)})}a.length&&(t(),new MutationObserver(t).observe(a[0],{childList:!0,subtree:!0}),a.off("dragstart.mm dragend.mm"),a.on("dragstart.mm",".attachment",function(e){const a=jQuery(this);let t=a.data("attachment-id")||a.data("id");if(!t){const e=a.attr("aria-label");if(e){const a=e.match(/id[:\s]+(\d+)/i);a&&(t=parseInt(a[1],10))}}t&&(e.originalEvent.dataTransfer.setData("text/plain",JSON.stringify({mediaId:t,title:a.find(".filename").text()||"",thumbnail:a.find("img").attr("src")||""})),e.originalEvent.dataTransfer.effectAllowed="move",a.addClass("mm-dragging"),document.body.classList.add("mm-internal-drag"))}),a.on("dragend.mm",".attachment",function(){jQuery(this).removeClass("mm-dragging"),document.body.classList.remove("mm-internal-drag")}))}(e),function(e){const a=()=>{const t=document.querySelector(".mm-folder-tree-sidebar"),n=e.$el.find(".attachments-wrapper")[0],r=e.$el.find(".attachments")[0];if(!t)return void setTimeout(a,100);if(!n||!r)return;let o=!1;function i(){const e=window.getComputedStyle(r),a=parseInt(e.paddingTop,10)||0;return(r.offsetTop||0)+a+8}let l=i();function d(){l=i(),l<0&&(l=0),m()}setTimeout(d,100),setTimeout(d,300),setTimeout(d,600);const s=e.$el.find(".uploader-inline")[0];function m(){const e=r.getBoundingClientRect().top,a=n.getBoundingClientRect();e>=32?(t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.transform=`translateY(${l}px)`):(t.style.position="fixed",t.style.top="32px",t.style.left=`${a.left}px`,t.style.transform="translateY(0)"),o=!1}function c(){o||(requestAnimationFrame(m),o=!0)}function u(){d()}s&&new MutationObserver(()=>{setTimeout(d,50)}).observe(s,{attributes:!0,attributeFilter:["style","class"]}),window.addEventListener("scroll",c,{passive:!0}),window.addEventListener("resize",u,{passive:!0}),m(),t._cleanupSticky=()=>{window.removeEventListener("scroll",c),window.removeEventListener("resize",u)}};a()}(e)):(t.removeClass("is-visible"),n.removeClass("is-active"),document.body.classList.remove("mm-folder-view-active"),e.$el.removeClass("mm-sidebar-visible"),jQuery(".view-switch a.view-grid").addClass("current")),localStorage.setItem("mm_folder_view",a?"1":"0")}function C(){if("undefined"==typeof wp||void 0===wp.media)return;const e=wp.media.view.AttachmentsBrowser.prototype.render;wp.media.view.AttachmentsBrowser.prototype.render=function(){const r=e.apply(this,arguments);return function(e){if(e.$el.find("#mm-folder-tree").length)return;const r=document.createElement("div");r.id="mm-folder-tree",r.className="mm-folder-tree-sidebar";const o=e.$el.find(".attachments-wrapper").first(),l=e.$el;o.length?o.prepend(r):l.prepend(r),_=(0,a.createRoot)(r),_.render((0,i.jsxs)(t.SlotFillProvider,{children:[(0,i.jsx)(v,{onFolderSelect:a=>{const t=new URL(window.location);a?t.searchParams.set("mm_folder",a):t.searchParams.delete("mm_folder"),window.history.pushState({},"",t);const n=e.collection;if(n){const t=e.$el.find(".attachments");t.addClass("mm-loading"),null!==a?e.$el.addClass("mm-folder-filtered"):e.$el.removeClass("mm-folder-filtered"),n.props.unset("media_folder"),n.props.unset("media_folder_exclude"),"uncategorized"===a?n.props.set({media_folder_exclude:"all"}):a&&n.props.set({media_folder:a}),n.reset(),n.more({remove:!1}).then(()=>{t.removeClass("mm-loading")}).catch(()=>{t.removeClass("mm-loading")})}}}),(0,i.jsx)(t.Popover.Slot,{})]})),function(e){if(x=e,!jQuery(".mm-folder-toggle-button").length){const a='<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" aria-hidden="true" focusable="false"><path d="M4 5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-7.5l-2-2H4z"/></svg>',t=e.$el.find(".media-toolbar-secondary");if(t.length){const r=jQuery(`\n\t\t\t\t<button type="button" class="mm-folder-toggle-button" title="${(0,n.__)("Show Folders","mediamanager")}">\n\t\t\t\t\t<span class="screen-reader-text">${(0,n.__)("Show Folders","mediamanager")}</span>\n\t\t\t\t\t${a}\n\t\t\t\t</button>\n\t\t\t`);t.prepend(r),r.on("click",a=>{a.preventDefault(),j(e,!0)})}}const a=localStorage.getItem("mm_folder_view"),t=new URLSearchParams(window.location.search);("1"===a||t.has("mm_folder"))&&j(e,!0)}(e)}(this),r}}jQuery(document).on("click",".view-switch a",function(){!function(){w=!1,localStorage.setItem("mm_folder_view","0");const e=jQuery("#mm-folder-tree"),a=jQuery(".mm-folder-toggle-button");e.removeClass("is-visible"),a.removeClass("is-active"),document.body.classList.remove("mm-folder-view-active"),jQuery(".attachments-browser").removeClass("mm-sidebar-visible")}()}),jQuery(document).on("click",".page-title-action",function(){jQuery(".attachments-browser").hasClass("mm-folder-filtered")&&"function"==typeof window.mediaManagerSelectFolder&&window.mediaManagerSelectFolder(null)}),jQuery(document).ready(function(){!function(){const e=localStorage.getItem("mm_folder_view"),a=new URLSearchParams(window.location.search),t="1"===e||a.has("mm_folder"),r=jQuery(".mm-folder-toggle-button");if(r.length)return void(t&&r.addClass("is-active"));const o=jQuery(".view-switch");if(o.length){const e=jQuery(`\n\t\t\t<a href="#" class="mm-folder-toggle-button${t?" is-active":""}" title="${(0,n.__)("Show Folders","mediamanager")}">\n\t\t\t\t<span class="screen-reader-text">${(0,n.__)("Show Folders","mediamanager")}</span>\n\t\t\t\t<svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" aria-hidden="true" focusable="false"><path d="M4 5a2 2 0 0 0-2 2v10a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-7.5l-2-2H4z"/></svg>\n\t\t\t</a>\n\t\t`);o.before(e),e.on("click",a=>{if(a.preventDefault(),"list"===new URLSearchParams(window.location.search).get("mode"))return localStorage.setItem("mm_folder_view","1"),void(window.location.href=window.location.pathname+"?mode=grid");x?j(x,!0):(localStorage.setItem("mm_folder_view","1"),w=!0,e.addClass("is-active"))})}}()}),window.mediaManagerMoveToFolder=async function(e,a){const{ajaxUrl:t,nonce:r}=window.mediaManagerData||{};if(!t||!r)return void console.error("Media Manager: Missing AJAX configuration");const o=new FormData;o.append("action","mm_move_to_folder"),o.append("nonce",r),o.append("media_id",e),o.append("folder_id",null!=a?a:"");try{const e=await fetch(t,{method:"POST",credentials:"same-origin",body:o}),a=await e.json();a.success?(a.data?.message&&b(a.data.message,"success"),window.mediaManagerRefreshFolders&&window.mediaManagerRefreshFolders(),function(){const e=jQuery(".mm-folder-button.is-selected");if(e.length)setTimeout(()=>{e.trigger("click")},100);else try{if(wp.media?.frame?.content?.get){const e=wp.media.frame.content.get();e&&e.collection&&(e.collection.reset(),e.collection.more({remove:!1}))}}catch(e){console.error("Error refreshing media library:",e)}}()):b(a.data?.message||(0,n.__)("Failed to move media.","mediamanager"),"error")}catch(e){console.error("Error moving media:",e),b((0,n.__)("Failed to move media.","mediamanager"),"error")}},"loading"===document.readyState?document.addEventListener("DOMContentLoaded",C):C()})();