(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,r=window.wp.apiFetch;var n=e.n(r);const l="vmf_folders_cache";function a(e){const t={},r=[];return e.forEach(e=>{t[e.id]={...e,children:[]}}),e.forEach(e=>{e.parent&&t[e.parent]?t[e.parent].children.push(t[e.id]):r.push(t[e.id])}),r}const o=window.wp.i18n,d=window.ReactJSXRuntime;function i({expanded:e}){return(0,d.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e?(0,d.jsx)("polyline",{points:"6 9 12 15 18 9"}):(0,d.jsx)("polyline",{points:"9 6 15 12 9 18"})})}function s({folder:e,selectedId:r,onSelect:n,level:l=0,parentId:a=null,renderWrapper:c,enableKeyboardNav:f=!1,enableAutoExpand:u=!1,enableAria:m=!1}){const p=e=>!(!e.children||0===e.children.length)&&e.children.some(e=>e.id===r||p(e)),v=u&&p(e),[h,g]=(0,t.useState)(v),w=h||v,y=e.children&&e.children.length>0,b=r===e.id;(0,t.useEffect)(()=>{v&&!h&&g(!0)},[v,h]);const x=(0,d.jsxs)("button",{type:"button",className:"vmf-folder-button "+(b?"is-selected":""),style:{paddingLeft:16*l+8+"px"},onClick:()=>n(e.id),onKeyDown:f?t=>{f&&("ArrowRight"===t.key&&y&&!w?(t.preventDefault(),g(!0)):"ArrowLeft"===t.key?(t.preventDefault(),y&&w?g(!1):null!==a&&n(a)):"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),n(e.id)))}:void 0,"aria-current":b?"true":void 0,title:e.name,children:[y&&(0,d.jsx)("span",{className:"vmf-folder-toggle",onClick:t=>{t.stopPropagation(),w&&p(e)&&n(e.id),g(!w)},onKeyDown:f?t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),t.stopPropagation(),w&&p(e)&&n(e.id),g(!w))}:void 0,role:f?"button":void 0,tabIndex:f?0:void 0,"aria-label":w?(0,o.__)("Collapse","virtual-media-folders"):(0,o.__)("Expand","virtual-media-folders"),children:(0,d.jsx)(i,{expanded:w})}),(0,d.jsx)("span",{className:"vmf-folder-name",children:e.name}),"number"==typeof e.count&&(0,d.jsxs)("span",{className:"vmf-folder-count","aria-label":m?`${e.count} ${(0,o.__)("items","virtual-media-folders")}`:void 0,children:["(",e.count,")"]})]}),_=c?c({folderId:e.id,children:x}):x,j=m?{role:"treeitem","aria-expanded":y?w:void 0,"aria-selected":b}:{};return(0,d.jsxs)("li",{className:"vmf-folder-item",...j,children:[_,y&&w&&(0,d.jsx)("ul",{className:"vmf-folder-children",role:m?"group":void 0,children:e.children.map(t=>(0,d.jsx)(s,{folder:t,selectedId:r,onSelect:n,level:l+1,parentId:e.id,renderWrapper:c,enableKeyboardNav:f,enableAutoExpand:u,enableAria:m},t.id))})]})}function c({folders:e,selectedId:t,onSelect:r,uncategorizedCount:n,showAllMedia:l=!0,showUncategorized:a=!0,loading:i,renderWrapper:c,renderUncategorizedWrapper:f,renderHeader:u,enableKeyboardNav:m=!1,enableAutoExpand:p=!1,enableAria:v=!1,className:h="",loadingText:g}){if(i){const e=v?"vmf-folder-tree":"vmf-folder-sidebar";return(0,d.jsx)("div",{className:`${e} ${e}--loading ${h}`,"aria-label":v?(0,o.__)("Media folders","virtual-media-folders"):void 0,children:(0,d.jsx)("p",{"aria-live":v?"polite":void 0,children:g||(0,o.__)("Loadingâ€¦","virtual-media-folders")})})}const w=(0,d.jsx)("button",{type:"button",className:"vmf-folder-button "+(null===t?"is-selected":""),onClick:()=>r(null),"aria-current":null===t?"true":void 0,children:(0,d.jsx)("span",{className:"vmf-folder-name",children:(0,o.__)("All Media","virtual-media-folders")})}),y=(0,d.jsxs)("button",{type:"button",className:"vmf-folder-button "+("uncategorized"===t?"is-selected":""),onClick:()=>r("uncategorized"),"aria-current":"uncategorized"===t?"true":void 0,children:[(0,d.jsx)("span",{className:"vmf-folder-name",children:(0,o.__)("Uncategorized","virtual-media-folders")}),(0,d.jsxs)("span",{className:"vmf-folder-count","aria-label":v?`${n} ${(0,o.__)("items","virtual-media-folders")}`:void 0,children:["(",n,")"]})]}),b=f?f({children:y}):y,x=v?"nav":"div",_=v?"vmf-folder-tree":"vmf-folder-sidebar";return(0,d.jsxs)(x,{className:`${_} ${h}`,"aria-label":v?(0,o.__)("Media folders","virtual-media-folders"):void 0,children:[u&&u(),(0,d.jsxs)("ul",{className:"vmf-folder-list",role:v?"tree":void 0,"aria-label":v?(0,o.__)("Folder tree","virtual-media-folders"):void 0,children:[l&&(0,d.jsx)("li",{className:"vmf-folder-item",role:v?"treeitem":void 0,"aria-selected":v?null===t:void 0,children:w}),a&&(0,d.jsx)("li",{className:"vmf-folder-item",role:v?"treeitem":void 0,"aria-selected":v?"uncategorized"===t:void 0,children:b}),e.map(e=>(0,d.jsx)(s,{folder:e,selectedId:t,onSelect:r,renderWrapper:c,enableKeyboardNav:m,enableAutoExpand:p,enableAria:v},e.id))]})]})}function f({onFolderSelect:e}){const{showAllMedia:r=!0,showUncategorized:o=!0}=window.vmfEditor||{},{folders:i,selectedId:s,loading:f,uncategorizedCount:u,handleSelect:m}=function({trackUrl:e=!1,onFolderSelect:r,mediaType:o="",defaultFolder:d=null}={}){const i=function(){try{const e=localStorage.getItem(l);if(e)return JSON.parse(e)}catch(e){}return window.vmfData?.folders?window.vmfData.folders:window.vmfEditor?.folders?window.vmfEditor.folders:null}()||[],s=i.length>0?a(i):[],c=i.length>0,[f,u]=(0,t.useState)(s),[m,p]=(0,t.useState)(i),[v,h]=(0,t.useState)(d),[g,w]=(0,t.useState)(!c),[y,b]=(0,t.useState)(0),x=(0,t.useRef)(c?i:null),_=(0,t.useCallback)(e=>[...e].sort((e,t)=>{const r=e.vmf_order,n=t.vmf_order;return null!=r&&null!=n?r-n:null!=r?-1:null!=n?1:e.name.localeCompare(t.name)}),[]),j=(0,t.useCallback)((e,t=null)=>{const r=_(e),n=t?r.map(e=>{var r;return{...e,count:null!==(r=t[e.id])&&void 0!==r?r:e.count}}):r;p(n),u(a(n))},[_]),C=(0,t.useCallback)(async(e,t)=>{try{const r=function(e){if(!e||"all"===e)return"";if(e.includes("/")||e.includes(",")){const t=e.split(",")[0].split("/")[0];return["image","video","audio","application","text"].includes(t)?t:""}return e}(e);let l="/wp/v2/media?per_page=1";r&&(l+=`&media_type=${encodeURIComponent(r)}`);const a=await n()({path:l,parse:!1}),o=parseInt(a.headers.get("X-WP-Total"),10)||0;let d=0;t.forEach(e=>{d+=e.count||0}),b(Math.max(0,o-d))}catch(e){}},[]),N=(0,t.useCallback)(async(e=o,t=!1)=>{try{const r=await n()({path:"/vmf/v1/folders"}),a=t||!function(e,t){if(!e||!t)return!1;if(e.length!==t.length)return!1;const r=e=>JSON.stringify(e.map(e=>({id:e.id,name:e.name,parent:e.parent,vmf_order:e.vmf_order})));return r(e)===r(t)}(x.current,r);a&&(j(r),function(e){try{localStorage.setItem(l,JSON.stringify(e))}catch(e){}}(r),x.current=r);let o=r;if(e)try{const t=await n()({path:`/vmf/v1/folders/counts?media_type=${encodeURIComponent(e)}`});o=r.map(e=>{var r;return{...e,count:null!==(r=t[e.id])&&void 0!==r?r:e.count}}),j(o)}catch(e){}C(e,o)}catch(e){console.error("Error fetching folders:",e)}finally{w(!1)}},[o,j,C]);(0,t.useEffect)(()=>{let t=d;if(e){const e=new URLSearchParams(window.location.search),r=e.get("vmf_folder"),n=e.get("mode");r?(t="uncategorized"===r?"uncategorized":parseInt(r,10),h(t)):"folder"===n&&(h(d),t=d)}N(),null!==t&&r?.(t)},[N,e,d,r]),(0,t.useEffect)(()=>{void 0!==o&&N(o)},[o,N]);const S=(0,t.useCallback)(e=>{h(e),r?.(e)},[r]);return{folders:f,flatFolders:m,selectedId:v,setSelectedId:h,loading:g,uncategorizedCount:y,fetchFolders:N,handleSelect:S}}({trackUrl:!1,onFolderSelect:e});return(0,d.jsx)(c,{folders:i,selectedId:s,onSelect:m,uncategorizedCount:u,loading:f,showAllMedia:r,showUncategorized:o,enableKeyboardNav:!1,enableAutoExpand:!1,enableAria:!1})}function u(){if(!window.wp?.media?.view?.AttachmentsBrowser)return void setTimeout(u,100);const e=wp.media.view.AttachmentsBrowser.prototype.render;wp.media.view.AttachmentsBrowser.prototype.render=function(){if(e.apply(this,arguments),!this.$el.find(".vmf-editor-folder-sidebar").length){const e=this.$el.find(".attachments-wrapper").first(),r=this.$el.find(".attachments").first();if(e.length||r.length){const n=document.createElement("div");n.className="vmf-editor-folder-sidebar",e.length?e.prepend(n):r.before(n);const l=this.collection,a=this;(0,t.createRoot)(n).render((0,t.createElement)(f,{onFolderSelect:e=>{if(!l)return;const t=a.$el.find(".attachments");t.addClass("vmf-loading"),null!==e?a.$el.addClass("vmf-folder-filtered"):a.$el.removeClass("vmf-folder-filtered"),l.props.unset("media_folder"),l.props.unset("media_folder_exclude"),"uncategorized"===e?l.props.set({media_folder_exclude:"all"}):e&&""!==e&&l.props.set({media_folder:parseInt(e,10)}),l.reset(),l.more({remove:!1}).then(()=>{t.removeClass("vmf-loading")}).catch(()=>{t.removeClass("vmf-loading")})}})),this.$el.addClass("vmf-has-folder-sidebar"),function(e,t){const r=e.$el.find(".attachments-wrapper").first(),n=e.$el.find(".attachments").first();if(!r.length||!n.length)return;const l=r[0];let a=!1;function o(){const e=l.getBoundingClientRect(),r=l.scrollTop>0;r&&!a?(t.style.position="fixed",t.style.top=`${e.top}px`,t.style.left=`${e.left}px`,t.style.height=`${e.height}px`,t.style.width="220px",t.style.zIndex="100",a=!0):!r&&a?(t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.height="100%",t.style.width="",t.style.zIndex="",a=!1):a&&(t.style.top=`${e.top}px`,t.style.left=`${e.left}px`,t.style.height=`${e.height}px`)}l.addEventListener("scroll",()=>{requestAnimationFrame(o)},{passive:!0}),window.addEventListener("resize",o,{passive:!0}),setTimeout(o,100)}(this,n)}}return this}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",u):u()})();