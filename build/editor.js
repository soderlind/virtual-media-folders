(()=>{"use strict";var e={n:t=>{var r=t&&t.__esModule?()=>t.default:()=>t;return e.d(r,{a:r}),r},d:(t,r)=>{for(var n in r)e.o(r,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:r[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{initGutenbergIntegration:()=>w});const r=window.wp.element,n=window.wp.apiFetch;var l=e.n(n);const o="vmfo_folders_cache";function a(e){const t={},r=[];return e.forEach(e=>{t[e.id]={...e,children:[]}}),e.forEach(e=>{e.parent&&t[e.parent]?t[e.parent].children.push(t[e.id]):r.push(t[e.id])}),r}const i=window.wp.i18n,d=window.ReactJSXRuntime;function s({expanded:e}){return(0,d.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e?(0,d.jsx)("polyline",{points:"6 9 12 15 18 9"}):(0,d.jsx)("polyline",{points:"9 6 15 12 9 18"})})}function c({folder:e,selectedId:t,onSelect:n,level:l=0,parentId:o=null,renderWrapper:a,enableKeyboardNav:u=!1,enableAutoExpand:f=!1,enableAria:m=!1,isMoveModeActive:v=!1,forceExpand:p=!1}){const h=e=>!(!e.children||0===e.children.length)&&e.children.some(e=>e.id===t||h(e)),g=f&&h(e),[w,x]=(0,r.useState)(g),b=p||w||g,y=e.children&&e.children.length>0,_=t===e.id;(0,r.useEffect)(()=>{g&&!w&&x(!0)},[g,w]);const S=(0,d.jsxs)("button",{type:"button",className:"vmf-folder-button "+(_?"is-selected":""),style:{paddingLeft:16*l+8+"px"},onClick:()=>n(e.id),onKeyDown:u?t=>{if(u)if("ArrowRight"===t.key&&y&&!b)t.preventDefault(),x(!0);else if("ArrowLeft"===t.key)t.preventDefault(),y&&b?x(!1):null!==o&&n(o);else if("Enter"===t.key||" "===t.key){if(v)return;t.preventDefault(),n(e.id)}}:void 0,"aria-current":_?"true":void 0,title:e.name,children:[y?(0,d.jsx)("span",{className:"vmf-folder-toggle",onClick:t=>{t.stopPropagation(),b&&h(e)&&n(e.id),x(!b)},onKeyDown:u?t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),t.stopPropagation(),b&&h(e)&&n(e.id),x(!b))}:void 0,role:u?"button":void 0,tabIndex:u?0:void 0,"aria-label":b?(0,i.__)("Collapse","virtual-media-folders"):(0,i.__)("Expand","virtual-media-folders"),children:(0,d.jsx)(s,{expanded:b})}):(0,d.jsx)("span",{className:"vmf-folder-toggle vmf-folder-toggle--placeholder","aria-hidden":"true"}),(0,d.jsx)("span",{className:"vmf-folder-name",children:e.name}),"number"==typeof e.count&&!(y&&0===e.count)&&(0,d.jsxs)("span",{className:"vmf-folder-count","aria-label":m?`${e.count} ${(0,i.__)("items","virtual-media-folders")}`:void 0,children:["(",e.count,")"]})]}),j=a?a({folderId:e.id,children:S}):S,C=m?{role:"treeitem","aria-expanded":y?b:void 0,"aria-selected":_}:{};return(0,d.jsxs)("li",{className:"vmf-folder-item",...C,children:[j,y&&b&&(0,d.jsx)("ul",{className:"vmf-folder-children",role:m?"group":void 0,children:e.children.map(r=>(0,d.jsx)(c,{folder:r,selectedId:t,onSelect:n,level:l+1,parentId:e.id,renderWrapper:a,enableKeyboardNav:u,enableAutoExpand:f,enableAria:m,isMoveModeActive:v,forceExpand:p},r.id))})]})}function u({folders:e,selectedId:t,onSelect:r,uncategorizedCount:n,showAllMedia:l=!0,showUncategorized:o=!0,loading:a,renderWrapper:s,renderUncategorizedWrapper:u,renderHeader:f,enableKeyboardNav:m=!1,enableAutoExpand:v=!1,enableAria:p=!1,isMoveModeActive:h=!1,forceExpand:g=!1,className:w="",loadingText:x}){if(a){const e=p?"vmf-folder-tree":"vmf-folder-sidebar";return(0,d.jsx)("div",{className:`${e} ${e}--loading ${w}`,"aria-label":p?(0,i.__)("Media folders","virtual-media-folders"):void 0,children:(0,d.jsx)("p",{"aria-live":p?"polite":void 0,children:x||(0,i.__)("Loading…","virtual-media-folders")})})}const b=(0,d.jsx)("button",{type:"button",className:"vmf-folder-button "+(null===t?"is-selected":""),onClick:()=>r(null),"aria-current":null===t?"true":void 0,children:(0,d.jsx)("span",{className:"vmf-folder-name",children:(0,i.__)("All Media","virtual-media-folders")})}),y=(0,d.jsxs)("button",{type:"button",className:"vmf-folder-button "+("uncategorized"===t?"is-selected":""),onClick:()=>r("uncategorized"),"aria-current":"uncategorized"===t?"true":void 0,children:[(0,d.jsx)("span",{className:"vmf-folder-name",children:(0,i.__)("Uncategorized","virtual-media-folders")}),(0,d.jsxs)("span",{className:"vmf-folder-count","aria-label":p?`${n} ${(0,i.__)("items","virtual-media-folders")}`:void 0,children:["(",n,")"]})]}),_=u?u({children:y}):y,S=p?"nav":"div",j=p?"vmf-folder-tree":"vmf-folder-sidebar";return(0,d.jsxs)(S,{className:`${j} ${w}`,"aria-label":p?(0,i.__)("Media folders","virtual-media-folders"):void 0,children:[f&&f(),(0,d.jsxs)("ul",{className:"vmf-folder-list",role:p?"tree":void 0,"aria-label":p?(0,i.__)("Folder tree","virtual-media-folders"):void 0,children:[l&&(0,d.jsx)("li",{className:"vmf-folder-item",role:p?"treeitem":void 0,"aria-selected":p?null===t:void 0,children:b}),o&&(0,d.jsx)("li",{className:"vmf-folder-item",role:p?"treeitem":void 0,"aria-selected":p?"uncategorized"===t:void 0,children:_}),e.map(e=>(0,d.jsx)(c,{folder:e,selectedId:t,onSelect:r,renderWrapper:s,enableKeyboardNav:m,enableAutoExpand:v,enableAria:p,isMoveModeActive:h,forceExpand:g},e.id))]})]})}(0,i.__)("Overview","virtual-media-folders"),(0,i.__)("Dashboard","virtual-media-folders"),(0,i.__)("Configure","virtual-media-folders"),(0,i.__)("Actions","virtual-media-folders");const f=window.wp.components,m=window.wp.primitives;var v=(0,d.jsx)(m.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,d.jsx)(m.Path,{d:"M13 5c-3.3 0-6 2.7-6 6 0 1.4.5 2.7 1.3 3.7l-3.8 3.8 1.1 1.1 3.8-3.8c1 .8 2.3 1.3 3.7 1.3 3.3 0 6-2.7 6-6S16.3 5 13 5zm0 10.5c-2.5 0-4.5-2-4.5-4.5s2-4.5 4.5-4.5 4.5 2 4.5 4.5-2 4.5-4.5 4.5z"})}),p=(0,d.jsx)(m.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",children:(0,d.jsx)(m.Path,{d:"M12 13.06l3.712 3.713 1.061-1.06L13.061 12l3.712-3.712-1.06-1.06L12 10.938 8.288 7.227l-1.061 1.06L10.939 12l-3.712 3.712 1.06 1.061L12 13.061z"})});function h({searchQuery:e,onSearchChange:t}){const[n,l]=(0,r.useState)(!1),o=(0,r.useRef)(null);(0,r.useEffect)(()=>{n&&o.current&&o.current.focus()},[n]);const a=()=>{l(!1),t("")};return n?(0,d.jsxs)("div",{className:"vmf-editor-search",children:[(0,d.jsxs)("div",{className:"vmf-editor-search__input-wrapper",children:[(0,d.jsx)("input",{ref:o,type:"text",className:"vmf-editor-search__input",placeholder:(0,i.__)("Search folders…","virtual-media-folders"),value:e,onChange:e=>{t(e.target.value)},onKeyDown:e=>{"Escape"===e.key&&a()},"aria-label":(0,i.__)("Search folders","virtual-media-folders")}),e&&(0,d.jsx)(f.Button,{icon:p,label:(0,i.__)("Clear search","virtual-media-folders"),onClick:()=>{t(""),o.current&&o.current.focus()},className:"vmf-editor-search__clear",size:"small",showTooltip:!1})]}),(0,d.jsx)(f.Button,{icon:p,label:(0,i.__)("Close search","virtual-media-folders"),onClick:a,className:"vmf-editor-search__close",size:"small",showTooltip:!1})]}):(0,d.jsx)(f.Button,{icon:v,label:(0,i.__)("Search folders","virtual-media-folders"),onClick:()=>{l(!0)},className:"vmf-editor-search-button",size:"small",showTooltip:!1})}function g({onFolderSelect:e}){const{showAllMedia:t=!0,showUncategorized:n=!0}=window.vmfEditor||{},i=t?null:"uncategorized",[s,c]=(0,r.useState)(""),{folders:f,selectedId:m,loading:v,uncategorizedCount:p,handleSelect:g}=function({trackUrl:e=!1,onFolderSelect:t,mediaType:n="",defaultFolder:i=null}={}){const d=function(){if(window.vmfData?.folders)return window.vmfData.folders;if(window.vmfEditor?.folders)return window.vmfEditor.folders;try{const e=localStorage.getItem(o);if(e)return JSON.parse(e)}catch(e){}return null}()||[],s=d.length>0?a(d):[],c=d.length>0,[u,f]=(0,r.useState)(s),[m,v]=(0,r.useState)(d),[p,h]=(0,r.useState)(i),[g,w]=(0,r.useState)(!c),[x,b]=(0,r.useState)(0),y=(0,r.useRef)(c?d:null),_=(0,r.useRef)(t);(0,r.useEffect)(()=>{_.current=t},[t]);const S=(0,r.useRef)(!1),j=(0,r.useRef)(!0);(0,r.useEffect)(()=>(j.current=!0,()=>{j.current=!1}),[]);const C=(0,r.useCallback)(e=>[...e].sort((e,t)=>{const r=e.vmfo_order,n=t.vmfo_order;return null!=r&&null!=n?r-n:null!=r?-1:null!=n?1:e.name.localeCompare(t.name)}),[]),E=(0,r.useCallback)((e,t=null)=>{const r=C(e),n=t?r.map(e=>{var r;return{...e,count:null!==(r=t[e.id])&&void 0!==r?r:e.count}}):r;v(n),f(a(n))},[C]),N=(0,r.useCallback)(async(e,t)=>{try{const r=function(e){if(!e||"all"===e)return"";if(e.includes("/")||e.includes(",")){const t=e.split(",")[0].split("/")[0];return["image","video","audio","application","text"].includes(t)?t:""}return e}(e);let n="/wp/v2/media?per_page=1";r&&(n+=`&media_type=${encodeURIComponent(r)}`);const o=await l()({path:n,parse:!1});if(!j.current)return;const a=parseInt(o.headers.get("X-WP-Total"),10)||0;let i=0;t.forEach(e=>{i+=e.count||0}),b(Math.max(0,a-i))}catch(e){}},[]),k=(0,r.useCallback)(async(e=n,t=!1)=>{try{const r=await l()({path:"/vmfo/v1/folders"});if(!j.current)return;const n=t||!function(e,t){if(!e||!t)return!1;if(e.length!==t.length)return!1;const r=e=>JSON.stringify(e.map(e=>({id:e.id,name:e.name,parent:e.parent,vmfo_order:e.vmfo_order})));return r(e)===r(t)}(y.current,r);n&&(E(r),function(e){try{localStorage.setItem(o,JSON.stringify(e))}catch(e){}}(r),y.current=r);let a=r;if(e)try{const t=await l()({path:`/vmfo/v1/folders/counts?media_type=${encodeURIComponent(e)}`});if(!j.current)return;a=r.map(e=>{var r;return{...e,count:null!==(r=t[e.id])&&void 0!==r?r:e.count}}),E(a)}catch(e){}N(e,a)}catch(e){console.error("Error fetching folders:",e)}finally{j.current&&w(!1)}},[n,E,N]);(0,r.useEffect)(()=>{if(S.current)return;S.current=!0;let t=i;if(e){const e=new URLSearchParams(window.location.search),r=e.get("vmfo_folder"),n=e.get("mode");r?(t="uncategorized"===r?"uncategorized":parseInt(r,10),h(t)):"folder"===n?(h(i),t=i):"grid"!==n&&"list"!==n||(t=null,h(null))}k(),null!==t&&_.current?.(t)},[k,e,i]),(0,r.useEffect)(()=>{void 0!==n&&k(n)},[n,k]);const z=(0,r.useCallback)(e=>{h(e),_.current?.(e)},[]);return{folders:u,flatFolders:m,selectedId:p,setSelectedId:h,loading:g,uncategorizedCount:x,fetchFolders:k,handleSelect:z}}({trackUrl:!1,onFolderSelect:e,defaultFolder:i}),w=(0,r.useCallback)((e,t)=>{if(!t.trim())return e;const r=t.toLowerCase(),n=e=>e.reduce((e,t)=>{const l=t.name.toLowerCase().includes(r),o=t.children?n(t.children):[];return(l||o.length>0)&&e.push({...t,children:o}),e},[]);return n(e)},[]),x=w(f,s),b=f.length>10,y=(0,r.useCallback)(()=>b?(0,d.jsx)("div",{className:"vmf-folder-sidebar-header",children:(0,d.jsx)(h,{searchQuery:s,onSearchChange:c})}):null,[s,b]);return(0,d.jsx)(u,{folders:x,selectedId:m,onSelect:g,uncategorizedCount:p,loading:v,showAllMedia:t,showUncategorized:n,renderHeader:y,enableKeyboardNav:!1,enableAutoExpand:!1,enableAria:!1,forceExpand:!!s.trim()})}function w(){if(!window.wp?.media?.view?.AttachmentsBrowser)return void setTimeout(w,100);const e=wp.media.view.AttachmentsBrowser.prototype.render;wp.media.view.AttachmentsBrowser.prototype.render=function(){if(e.apply(this,arguments),!this.$el.find(".vmf-editor-folder-sidebar").length){const e=this.$el.find(".attachments-wrapper").first(),t=this.$el.find(".attachments").first();if(e.length||t.length){const n=document.createElement("div");n.className="vmf-editor-folder-sidebar",e.length?e.prepend(n):t.before(n);const l=this.collection,o=this;(0,r.createRoot)(n).render((0,r.createElement)(g,{onFolderSelect:e=>{if(!l)return;const t=o.$el.find(".attachments");t.addClass("vmf-loading"),null!==e?o.$el.addClass("vmf-folder-filtered"):o.$el.removeClass("vmf-folder-filtered"),l.props.unset("vmfo_folder"),l.props.unset("vmfo_folder_exclude"),"uncategorized"===e?l.props.set({vmfo_folder_exclude:"all"}):e&&""!==e&&l.props.set({vmfo_folder:parseInt(e,10)}),l.reset(),l.more({remove:!1}).then(()=>{t.removeClass("vmf-loading")}).catch(()=>{t.removeClass("vmf-loading")})}})),this.$el.addClass("vmf-has-folder-sidebar"),function(e,t){const r=e.$el.find(".attachments-wrapper").first(),n=e.$el.find(".attachments").first();if(!r.length||!n.length)return()=>{};const l=r[0];let o=!1;function a(){const e=l.getBoundingClientRect(),r=l.scrollTop>0;r&&!o?(t.style.position="fixed",t.style.top=`${e.top}px`,t.style.left=`${e.left}px`,t.style.height=`${e.height}px`,t.style.width="220px",t.style.zIndex="100",o=!0):!r&&o?(t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.height="100%",t.style.width="",t.style.zIndex="",o=!1):o&&(t.style.top=`${e.top}px`,t.style.left=`${e.left}px`,t.style.height=`${e.height}px`)}function i(){requestAnimationFrame(a)}l.addEventListener("scroll",i,{passive:!0}),window.addEventListener("resize",a,{passive:!0}),setTimeout(a,100),t._cleanupSticky=()=>{l.removeEventListener("scroll",i),window.removeEventListener("resize",a)},t._cleanupSticky}(this,n)}}return this}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",w):w(),(window.vmfo=window.vmfo||{}).editor=t})();