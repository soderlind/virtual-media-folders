(()=>{"use strict";var e={n:t=>{var a=t&&t.__esModule?()=>t.default:()=>t;return e.d(a,{a}),a},d:(t,a)=>{for(var r in a)e.o(a,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:a[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,a=window.wp.apiFetch;var r=e.n(a);const n=window.wp.i18n,l=window.ReactJSXRuntime;function o({expanded:e}){return(0,l.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e?(0,l.jsx)("polyline",{points:"6 9 12 15 18 9"}):(0,l.jsx)("polyline",{points:"9 6 15 12 9 18"})})}function d({folder:e,selectedId:a,onSelect:r,level:i=0,renderWrapper:s,enableKeyboardNav:c=!1,enableAutoExpand:m=!1,enableAria:p=!1}){const u=e=>!(!e.children||0===e.children.length)&&e.children.some(e=>e.id===a||u(e)),f=m&&u(e),[h,g]=(0,t.useState)(f),v=h||f,b=e.children&&e.children.length>0,x=a===e.id;(0,t.useEffect)(()=>{f&&!h&&g(!0)},[f,h]);const y=(0,l.jsxs)("button",{type:"button",className:"mm-folder-button "+(x?"is-selected":""),style:{paddingLeft:16*i+8+"px"},onClick:()=>r(e.id),onKeyDown:c?t=>{c&&("ArrowRight"===t.key&&b&&!v?(t.preventDefault(),g(!0)):"ArrowLeft"===t.key&&b&&v?(t.preventDefault(),g(!1)):"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),r(e.id)))}:void 0,"aria-current":x?"true":void 0,title:e.name,children:[b&&(0,l.jsx)("span",{className:"mm-folder-toggle",onClick:e=>{e.stopPropagation(),g(!v)},onKeyDown:c?e=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),e.stopPropagation(),g(!v))}:void 0,role:c?"button":void 0,tabIndex:c?0:void 0,"aria-label":v?(0,n.__)("Collapse","mediamanager"):(0,n.__)("Expand","mediamanager"),children:(0,l.jsx)(o,{expanded:v})}),(0,l.jsx)("span",{className:"mm-folder-name",children:e.name}),"number"==typeof e.count&&(0,l.jsxs)("span",{className:"mm-folder-count","aria-label":p?`${e.count} ${(0,n.__)("items","mediamanager")}`:void 0,children:["(",e.count,")"]})]}),w=s?s({folderId:e.id,children:y}):y,_=p?{role:"treeitem","aria-expanded":b?v:void 0,"aria-selected":x}:{};return(0,l.jsxs)("li",{className:"mm-folder-item",..._,children:[w,b&&v&&(0,l.jsx)("ul",{className:"mm-folder-children",role:p?"group":void 0,children:e.children.map(e=>(0,l.jsx)(d,{folder:e,selectedId:a,onSelect:r,level:i+1,renderWrapper:s,enableKeyboardNav:c,enableAutoExpand:m,enableAria:p},e.id))})]})}function i({folders:e,selectedId:t,onSelect:a,uncategorizedCount:r,loading:o,renderWrapper:i,renderUncategorizedWrapper:s,renderHeader:c,enableKeyboardNav:m=!1,enableAutoExpand:p=!1,enableAria:u=!1,className:f="",loadingText:h}){if(o){const e=u?"mm-folder-tree":"mm-folder-sidebar";return(0,l.jsx)("div",{className:`${e} ${e}--loading ${f}`,"aria-label":u?(0,n.__)("Media folders","mediamanager"):void 0,children:(0,l.jsx)("p",{"aria-live":u?"polite":void 0,children:h||(0,n.__)("Loadingâ€¦","mediamanager")})})}const g=(0,l.jsx)("button",{type:"button",className:"mm-folder-button "+(null===t?"is-selected":""),onClick:()=>a(null),"aria-current":null===t?"true":void 0,children:(0,l.jsx)("span",{className:"mm-folder-name",children:(0,n.__)("All Media","mediamanager")})}),v=(0,l.jsxs)("button",{type:"button",className:"mm-folder-button "+("uncategorized"===t?"is-selected":""),onClick:()=>a("uncategorized"),"aria-current":"uncategorized"===t?"true":void 0,children:[(0,l.jsx)("span",{className:"mm-folder-name",children:(0,n.__)("Uncategorized","mediamanager")}),(0,l.jsxs)("span",{className:"mm-folder-count","aria-label":u?`${r} ${(0,n.__)("items","mediamanager")}`:void 0,children:["(",r,")"]})]}),b=s?s({children:v}):v,x=u?"nav":"div",y=u?"mm-folder-tree":"mm-folder-sidebar";return(0,l.jsxs)(x,{className:`${y} ${f}`,"aria-label":u?(0,n.__)("Media folders","mediamanager"):void 0,children:[c&&c(),(0,l.jsxs)("ul",{className:"mm-folder-list",role:u?"tree":void 0,"aria-label":u?(0,n.__)("Folder tree","mediamanager"):void 0,children:[(0,l.jsx)("li",{className:"mm-folder-item",role:u?"treeitem":void 0,"aria-selected":u?null===t:void 0,children:g}),(0,l.jsx)("li",{className:"mm-folder-item",role:u?"treeitem":void 0,"aria-selected":u?"uncategorized"===t:void 0,children:b}),e.map(e=>(0,l.jsx)(d,{folder:e,selectedId:t,onSelect:a,renderWrapper:i,enableKeyboardNav:m,enableAutoExpand:p,enableAria:u},e.id))]})]})}function s({onFolderSelect:e}){const{folders:a,selectedId:n,loading:o,uncategorizedCount:d,handleSelect:s}=function({trackUrl:e=!1,onFolderSelect:a}={}){const[n,l]=(0,t.useState)([]),[o,d]=(0,t.useState)([]),[i,s]=(0,t.useState)(null),[c,m]=(0,t.useState)(!0),[p,u]=(0,t.useState)(0),f=(0,t.useCallback)(async()=>{try{const e=await r()({path:"/wp/v2/media-folders?per_page=100&hierarchical=1"});d(e);const t=function(e){const t={},a=[];return e.forEach(e=>{t[e.id]={...e,children:[]}}),e.forEach(e=>{e.parent&&t[e.parent]?t[e.parent].children.push(t[e.id]):a.push(t[e.id])}),a}(e);l(t);const a=await r()({path:"/wp/v2/media?per_page=1",parse:!1}),n=parseInt(a.headers.get("X-WP-Total"),10)||0;let o=0;e.forEach(e=>{o+=e.count||0}),u(Math.max(0,n-o))}catch(e){console.error("Error fetching folders:",e)}finally{m(!1)}},[]);(0,t.useEffect)(()=>{if(e){const e=new URLSearchParams(window.location.search).get("mm_folder");e&&s("uncategorized"===e?"uncategorized":parseInt(e,10))}f()},[f,e]);const h=(0,t.useCallback)(e=>{s(e),a?.(e)},[a]);return{folders:n,flatFolders:o,selectedId:i,setSelectedId:s,loading:c,uncategorizedCount:p,fetchFolders:f,handleSelect:h}}({trackUrl:!1,onFolderSelect:e});return(0,l.jsx)(i,{folders:a,selectedId:n,onSelect:s,uncategorizedCount:d,loading:o,enableKeyboardNav:!1,enableAutoExpand:!1,enableAria:!1})}function c(){if(!window.wp?.media?.view?.AttachmentsBrowser)return void setTimeout(c,100);const e=wp.media.view.AttachmentsBrowser.prototype.render;wp.media.view.AttachmentsBrowser.prototype.render=function(){if(e.apply(this,arguments),!this.$el.find(".mm-editor-folder-sidebar").length){const e=this.$el.find(".attachments-wrapper").first(),a=this.$el.find(".attachments").first();if(e.length||a.length){const r=document.createElement("div");r.className="mm-editor-folder-sidebar",e.length?e.prepend(r):a.before(r);const n=this.collection,l=this;(0,t.createRoot)(r).render((0,t.createElement)(s,{onFolderSelect:e=>{if(!n)return;const t=l.$el.find(".attachments");t.addClass("mm-loading"),null!==e?l.$el.addClass("mm-folder-filtered"):l.$el.removeClass("mm-folder-filtered"),n.props.unset("media_folder"),n.props.unset("media_folder_exclude"),"uncategorized"===e?n.props.set({media_folder_exclude:"all"}):e&&""!==e&&n.props.set({media_folder:parseInt(e,10)}),n.reset(),n.more({remove:!1}).then(()=>{t.removeClass("mm-loading")}).catch(()=>{t.removeClass("mm-loading")})}})),this.$el.addClass("mm-has-folder-sidebar"),function(e,t){const a=e.$el.find(".attachments-wrapper").first(),r=e.$el.find(".attachments").first();if(!a.length||!r.length)return;const n=a[0];let l=!1;function o(){const e=n.getBoundingClientRect(),a=n.scrollTop>0;a&&!l?(t.style.position="fixed",t.style.top=`${e.top}px`,t.style.left=`${e.left}px`,t.style.height=`${e.height}px`,t.style.width="220px",t.style.zIndex="100",l=!0):!a&&l?(t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.height="100%",t.style.width="",t.style.zIndex="",l=!1):l&&(t.style.top=`${e.top}px`,t.style.left=`${e.left}px`,t.style.height=`${e.height}px`)}n.addEventListener("scroll",()=>{requestAnimationFrame(o)},{passive:!0}),window.addEventListener("resize",o,{passive:!0}),setTimeout(o,100)}(this,r)}}return this}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",c):c()})();