(()=>{"use strict";var e={n:t=>{var l=t&&t.__esModule?()=>t.default:()=>t;return e.d(l,{a:l}),l},d:(t,l)=>{for(var r in l)e.o(l,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:l[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,l=window.wp.apiFetch;var r=e.n(l);const n=window.wp.i18n,o=window.ReactJSXRuntime;function a({expanded:e}){return(0,o.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e?(0,o.jsx)("polyline",{points:"6 9 12 15 18 9"}):(0,o.jsx)("polyline",{points:"9 6 15 12 9 18"})})}function d({folder:e,selectedId:l,onSelect:r,level:i=0,parentId:s=null,renderWrapper:c,enableKeyboardNav:f=!1,enableAutoExpand:u=!1,enableAria:p=!1}){const m=e=>!(!e.children||0===e.children.length)&&e.children.some(e=>e.id===l||m(e)),v=u&&m(e),[h,g]=(0,t.useState)(v),x=h||v,b=e.children&&e.children.length>0,y=l===e.id;(0,t.useEffect)(()=>{v&&!h&&g(!0)},[v,h]);const w=(0,o.jsxs)("button",{type:"button",className:"vmf-folder-button "+(y?"is-selected":""),style:{paddingLeft:16*i+8+"px"},onClick:()=>r(e.id),onKeyDown:f?t=>{f&&("ArrowRight"===t.key&&b&&!x?(t.preventDefault(),g(!0)):"ArrowLeft"===t.key?(t.preventDefault(),b&&x?g(!1):null!==s&&r(s)):"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),r(e.id)))}:void 0,"aria-current":y?"true":void 0,title:e.name,children:[b&&(0,o.jsx)("span",{className:"vmf-folder-toggle",onClick:t=>{t.stopPropagation(),x&&m(e)&&r(e.id),g(!x)},onKeyDown:f?t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),t.stopPropagation(),x&&m(e)&&r(e.id),g(!x))}:void 0,role:f?"button":void 0,tabIndex:f?0:void 0,"aria-label":x?(0,n.__)("Collapse","virtual-media-folders"):(0,n.__)("Expand","virtual-media-folders"),children:(0,o.jsx)(a,{expanded:x})}),(0,o.jsx)("span",{className:"vmf-folder-name",children:e.name}),"number"==typeof e.count&&(0,o.jsxs)("span",{className:"vmf-folder-count","aria-label":p?`${e.count} ${(0,n.__)("items","virtual-media-folders")}`:void 0,children:["(",e.count,")"]})]}),_=c?c({folderId:e.id,children:w}):w,j=p?{role:"treeitem","aria-expanded":b?x:void 0,"aria-selected":y}:{};return(0,o.jsxs)("li",{className:"vmf-folder-item",...j,children:[_,b&&x&&(0,o.jsx)("ul",{className:"vmf-folder-children",role:p?"group":void 0,children:e.children.map(t=>(0,o.jsx)(d,{folder:t,selectedId:l,onSelect:r,level:i+1,parentId:e.id,renderWrapper:c,enableKeyboardNav:f,enableAutoExpand:u,enableAria:p},t.id))})]})}function i({folders:e,selectedId:t,onSelect:l,uncategorizedCount:r,showAllMedia:a=!0,showUncategorized:i=!0,loading:s,renderWrapper:c,renderUncategorizedWrapper:f,renderHeader:u,enableKeyboardNav:p=!1,enableAutoExpand:m=!1,enableAria:v=!1,className:h="",loadingText:g}){if(s){const e=v?"vmf-folder-tree":"vmf-folder-sidebar";return(0,o.jsx)("div",{className:`${e} ${e}--loading ${h}`,"aria-label":v?(0,n.__)("Media folders","virtual-media-folders"):void 0,children:(0,o.jsx)("p",{"aria-live":v?"polite":void 0,children:g||(0,n.__)("Loadingâ€¦","virtual-media-folders")})})}const x=(0,o.jsx)("button",{type:"button",className:"vmf-folder-button "+(null===t?"is-selected":""),onClick:()=>l(null),"aria-current":null===t?"true":void 0,children:(0,o.jsx)("span",{className:"vmf-folder-name",children:(0,n.__)("All Media","virtual-media-folders")})}),b=(0,o.jsxs)("button",{type:"button",className:"vmf-folder-button "+("uncategorized"===t?"is-selected":""),onClick:()=>l("uncategorized"),"aria-current":"uncategorized"===t?"true":void 0,children:[(0,o.jsx)("span",{className:"vmf-folder-name",children:(0,n.__)("Uncategorized","virtual-media-folders")}),(0,o.jsxs)("span",{className:"vmf-folder-count","aria-label":v?`${r} ${(0,n.__)("items","virtual-media-folders")}`:void 0,children:["(",r,")"]})]}),y=f?f({children:b}):b,w=v?"nav":"div",_=v?"vmf-folder-tree":"vmf-folder-sidebar";return(0,o.jsxs)(w,{className:`${_} ${h}`,"aria-label":v?(0,n.__)("Media folders","virtual-media-folders"):void 0,children:[u&&u(),(0,o.jsxs)("ul",{className:"vmf-folder-list",role:v?"tree":void 0,"aria-label":v?(0,n.__)("Folder tree","virtual-media-folders"):void 0,children:[a&&(0,o.jsx)("li",{className:"vmf-folder-item",role:v?"treeitem":void 0,"aria-selected":v?null===t:void 0,children:x}),i&&(0,o.jsx)("li",{className:"vmf-folder-item",role:v?"treeitem":void 0,"aria-selected":v?"uncategorized"===t:void 0,children:y}),e.map(e=>(0,o.jsx)(d,{folder:e,selectedId:t,onSelect:l,renderWrapper:c,enableKeyboardNav:p,enableAutoExpand:m,enableAria:v},e.id))]})]})}function s({onFolderSelect:e}){const{folders:l,selectedId:n,loading:a,uncategorizedCount:d,handleSelect:s}=function({trackUrl:e=!1,onFolderSelect:l,mediaType:n="",defaultFolder:o=null}={}){const[a,d]=(0,t.useState)([]),[i,s]=(0,t.useState)([]),[c,f]=(0,t.useState)(o),[u,p]=(0,t.useState)(!0),[m,v]=(0,t.useState)(0),h=(0,t.useCallback)(async(e=n)=>{try{const t=await r()({path:"/wp/v2/media-folders?per_page=100"});let l={};try{(await r()({path:"/vmf/v1/folders"})).forEach((e,t)=>{l[e.id]=t})}catch(e){console.log("Could not fetch folder order, using default")}const n=[...t].sort((e,t)=>{const r=l[e.id],n=l[t.id];return void 0!==r&&void 0!==n?r-n:void 0!==r?-1:void 0!==n?1:e.name.localeCompare(t.name)});let o=null;e&&(o=await r()({path:`/vmf/v1/folders/counts?media_type=${encodeURIComponent(e)}`}));const a=n.map(e=>({...e,count:o?o[e.id]||0:e.count}));s(a);const i=function(e){const t={},l=[];return e.forEach(e=>{t[e.id]={...e,children:[]}}),e.forEach(e=>{e.parent&&t[e.parent]?t[e.parent].children.push(t[e.id]):l.push(t[e.id])}),l}(a);d(i);const c=function(e){if(!e||"all"===e)return"";if(e.includes("/")||e.includes(",")){const t=e.split(",")[0].split("/")[0];return["image","video","audio","application","text"].includes(t)?t:""}return e}(e);let f="/wp/v2/media?per_page=1";c&&(f+=`&media_type=${encodeURIComponent(c)}`);const u=await r()({path:f,parse:!1}),p=parseInt(u.headers.get("X-WP-Total"),10)||0;let m=0;a.forEach(e=>{m+=e.count||0}),v(Math.max(0,p-m))}catch(e){console.error("Error fetching folders:",e)}finally{p(!1)}},[n]);(0,t.useEffect)(()=>{if(e){const e=new URLSearchParams(window.location.search),t=e.get("vmf_folder"),l=e.get("mode");t?f("uncategorized"===t?"uncategorized":parseInt(t,10)):"folder"===l&&f(o)}h()},[h,e,o]),(0,t.useEffect)(()=>{void 0!==n&&h(n)},[n,h]);const g=(0,t.useCallback)(e=>{f(e),l?.(e)},[l]);return{folders:a,flatFolders:i,selectedId:c,setSelectedId:f,loading:u,uncategorizedCount:m,fetchFolders:h,handleSelect:g}}({trackUrl:!1,onFolderSelect:e});return(0,o.jsx)(i,{folders:l,selectedId:n,onSelect:s,uncategorizedCount:d,loading:a,enableKeyboardNav:!1,enableAutoExpand:!1,enableAria:!1})}function c(){if(!window.wp?.media?.view?.AttachmentsBrowser)return void setTimeout(c,100);const e=wp.media.view.AttachmentsBrowser.prototype.render;wp.media.view.AttachmentsBrowser.prototype.render=function(){if(e.apply(this,arguments),!this.$el.find(".vmf-editor-folder-sidebar").length){const e=this.$el.find(".attachments-wrapper").first(),l=this.$el.find(".attachments").first();if(e.length||l.length){const r=document.createElement("div");r.className="vmf-editor-folder-sidebar",e.length?e.prepend(r):l.before(r);const n=this.collection,o=this;(0,t.createRoot)(r).render((0,t.createElement)(s,{onFolderSelect:e=>{if(!n)return;const t=o.$el.find(".attachments");t.addClass("vmf-loading"),null!==e?o.$el.addClass("vmf-folder-filtered"):o.$el.removeClass("vmf-folder-filtered"),n.props.unset("media_folder"),n.props.unset("media_folder_exclude"),"uncategorized"===e?n.props.set({media_folder_exclude:"all"}):e&&""!==e&&n.props.set({media_folder:parseInt(e,10)}),n.reset(),n.more({remove:!1}).then(()=>{t.removeClass("vmf-loading")}).catch(()=>{t.removeClass("vmf-loading")})}})),this.$el.addClass("vmf-has-folder-sidebar"),function(e,t){const l=e.$el.find(".attachments-wrapper").first(),r=e.$el.find(".attachments").first();if(!l.length||!r.length)return;const n=l[0];let o=!1;function a(){const e=n.getBoundingClientRect(),l=n.scrollTop>0;l&&!o?(t.style.position="fixed",t.style.top=`${e.top}px`,t.style.left=`${e.left}px`,t.style.height=`${e.height}px`,t.style.width="220px",t.style.zIndex="100",o=!0):!l&&o?(t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.height="100%",t.style.width="",t.style.zIndex="",o=!1):o&&(t.style.top=`${e.top}px`,t.style.left=`${e.left}px`,t.style.height=`${e.height}px`)}n.addEventListener("scroll",()=>{requestAnimationFrame(a)},{passive:!0}),window.addEventListener("resize",a,{passive:!0}),setTimeout(a,100)}(this,r)}}return this}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",c):c()})();