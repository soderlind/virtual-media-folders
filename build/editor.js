(()=>{"use strict";var e={n:t=>{var n=t&&t.__esModule?()=>t.default:()=>t;return e.d(n,{a:n}),n},d:(t,n)=>{for(var a in n)e.o(n,a)&&!e.o(t,a)&&Object.defineProperty(t,a,{enumerable:!0,get:n[a]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};const t=window.wp.element,n=window.wp.apiFetch;var a=e.n(n);const r=window.wp.i18n,l=window.ReactJSXRuntime;function o({expanded:e}){return(0,l.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e?(0,l.jsx)("polyline",{points:"6 9 12 15 18 9"}):(0,l.jsx)("polyline",{points:"9 6 15 12 9 18"})})}function d({folder:e,selectedId:n,onSelect:a,level:i=0,parentId:s=null,renderWrapper:c,enableKeyboardNav:m=!1,enableAutoExpand:p=!1,enableAria:u=!1}){const f=e=>!(!e.children||0===e.children.length)&&e.children.some(e=>e.id===n||f(e)),h=p&&f(e),[g,v]=(0,t.useState)(h),x=g||h,b=e.children&&e.children.length>0,y=n===e.id;(0,t.useEffect)(()=>{h&&!g&&v(!0)},[h,g]);const w=(0,l.jsxs)("button",{type:"button",className:"mm-folder-button "+(y?"is-selected":""),style:{paddingLeft:16*i+8+"px"},onClick:()=>a(e.id),onKeyDown:m?t=>{m&&("ArrowRight"===t.key&&b&&!x?(t.preventDefault(),v(!0)):"ArrowLeft"===t.key?(t.preventDefault(),b&&x?v(!1):null!==s&&a(s)):"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),a(e.id)))}:void 0,"aria-current":y?"true":void 0,title:e.name,children:[b&&(0,l.jsx)("span",{className:"mm-folder-toggle",onClick:t=>{t.stopPropagation(),x&&f(e)&&a(e.id),v(!x)},onKeyDown:m?t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),t.stopPropagation(),x&&f(e)&&a(e.id),v(!x))}:void 0,role:m?"button":void 0,tabIndex:m?0:void 0,"aria-label":x?(0,r.__)("Collapse","mediamanager"):(0,r.__)("Expand","mediamanager"),children:(0,l.jsx)(o,{expanded:x})}),(0,l.jsx)("span",{className:"mm-folder-name",children:e.name}),"number"==typeof e.count&&(0,l.jsxs)("span",{className:"mm-folder-count","aria-label":u?`${e.count} ${(0,r.__)("items","mediamanager")}`:void 0,children:["(",e.count,")"]})]}),_=c?c({folderId:e.id,children:w}):w,j=u?{role:"treeitem","aria-expanded":b?x:void 0,"aria-selected":y}:{};return(0,l.jsxs)("li",{className:"mm-folder-item",...j,children:[_,b&&x&&(0,l.jsx)("ul",{className:"mm-folder-children",role:u?"group":void 0,children:e.children.map(t=>(0,l.jsx)(d,{folder:t,selectedId:n,onSelect:a,level:i+1,parentId:e.id,renderWrapper:c,enableKeyboardNav:m,enableAutoExpand:p,enableAria:u},t.id))})]})}function i({folders:e,selectedId:t,onSelect:n,uncategorizedCount:a,showAllMedia:o=!0,showUncategorized:i=!0,loading:s,renderWrapper:c,renderUncategorizedWrapper:m,renderHeader:p,enableKeyboardNav:u=!1,enableAutoExpand:f=!1,enableAria:h=!1,className:g="",loadingText:v}){if(s){const e=h?"mm-folder-tree":"mm-folder-sidebar";return(0,l.jsx)("div",{className:`${e} ${e}--loading ${g}`,"aria-label":h?(0,r.__)("Media folders","mediamanager"):void 0,children:(0,l.jsx)("p",{"aria-live":h?"polite":void 0,children:v||(0,r.__)("Loadingâ€¦","mediamanager")})})}const x=(0,l.jsx)("button",{type:"button",className:"mm-folder-button "+(null===t?"is-selected":""),onClick:()=>n(null),"aria-current":null===t?"true":void 0,children:(0,l.jsx)("span",{className:"mm-folder-name",children:(0,r.__)("All Media","mediamanager")})}),b=(0,l.jsxs)("button",{type:"button",className:"mm-folder-button "+("uncategorized"===t?"is-selected":""),onClick:()=>n("uncategorized"),"aria-current":"uncategorized"===t?"true":void 0,children:[(0,l.jsx)("span",{className:"mm-folder-name",children:(0,r.__)("Uncategorized","mediamanager")}),(0,l.jsxs)("span",{className:"mm-folder-count","aria-label":h?`${a} ${(0,r.__)("items","mediamanager")}`:void 0,children:["(",a,")"]})]}),y=m?m({children:b}):b,w=h?"nav":"div",_=h?"mm-folder-tree":"mm-folder-sidebar";return(0,l.jsxs)(w,{className:`${_} ${g}`,"aria-label":h?(0,r.__)("Media folders","mediamanager"):void 0,children:[p&&p(),(0,l.jsxs)("ul",{className:"mm-folder-list",role:h?"tree":void 0,"aria-label":h?(0,r.__)("Folder tree","mediamanager"):void 0,children:[o&&(0,l.jsx)("li",{className:"mm-folder-item",role:h?"treeitem":void 0,"aria-selected":h?null===t:void 0,children:x}),i&&(0,l.jsx)("li",{className:"mm-folder-item",role:h?"treeitem":void 0,"aria-selected":h?"uncategorized"===t:void 0,children:y}),e.map(e=>(0,l.jsx)(d,{folder:e,selectedId:t,onSelect:n,renderWrapper:c,enableKeyboardNav:u,enableAutoExpand:f,enableAria:h},e.id))]})]})}function s({onFolderSelect:e}){const{folders:n,selectedId:r,loading:o,uncategorizedCount:d,handleSelect:s}=function({trackUrl:e=!1,onFolderSelect:n,mediaType:r=""}={}){const[l,o]=(0,t.useState)([]),[d,i]=(0,t.useState)([]),[s,c]=(0,t.useState)(null),[m,p]=(0,t.useState)(!0),[u,f]=(0,t.useState)(0),h=(0,t.useCallback)(async(e=r)=>{try{const t=await a()({path:"/wp/v2/media-folders?per_page=100&hierarchical=1"});let n=null;e&&(n=await a()({path:`/mediamanager/v1/folders/counts?media_type=${encodeURIComponent(e)}`}));const r=t.map(e=>({...e,count:n?n[e.id]||0:e.count}));i(r);const l=function(e){const t={},n=[];return e.forEach(e=>{t[e.id]={...e,children:[]}}),e.forEach(e=>{e.parent&&t[e.parent]?t[e.parent].children.push(t[e.id]):n.push(t[e.id])}),n}(r);o(l);const d=function(e){if(!e||"all"===e)return"";if(e.includes("/")||e.includes(",")){const t=e.split(",")[0].split("/")[0];return["image","video","audio","application","text"].includes(t)?t:""}return e}(e);let s="/wp/v2/media?per_page=1";d&&(s+=`&media_type=${encodeURIComponent(d)}`);const c=await a()({path:s,parse:!1}),m=parseInt(c.headers.get("X-WP-Total"),10)||0;let p=0;r.forEach(e=>{p+=e.count||0}),f(Math.max(0,m-p))}catch(e){console.error("Error fetching folders:",e)}finally{p(!1)}},[r]);(0,t.useEffect)(()=>{if(e){const e=new URLSearchParams(window.location.search),t=e.get("mm_folder"),n=e.get("mode");t?c("uncategorized"===t?"uncategorized":parseInt(t,10)):"folder"===n&&c(null)}h()},[h,e]),(0,t.useEffect)(()=>{void 0!==r&&h(r)},[r,h]);const g=(0,t.useCallback)(e=>{c(e),n?.(e)},[n]);return{folders:l,flatFolders:d,selectedId:s,setSelectedId:c,loading:m,uncategorizedCount:u,fetchFolders:h,handleSelect:g}}({trackUrl:!1,onFolderSelect:e});return(0,l.jsx)(i,{folders:n,selectedId:r,onSelect:s,uncategorizedCount:d,loading:o,enableKeyboardNav:!1,enableAutoExpand:!1,enableAria:!1})}function c(){if(!window.wp?.media?.view?.AttachmentsBrowser)return void setTimeout(c,100);const e=wp.media.view.AttachmentsBrowser.prototype.render;wp.media.view.AttachmentsBrowser.prototype.render=function(){if(e.apply(this,arguments),!this.$el.find(".mm-editor-folder-sidebar").length){const e=this.$el.find(".attachments-wrapper").first(),n=this.$el.find(".attachments").first();if(e.length||n.length){const a=document.createElement("div");a.className="mm-editor-folder-sidebar",e.length?e.prepend(a):n.before(a);const r=this.collection,l=this;(0,t.createRoot)(a).render((0,t.createElement)(s,{onFolderSelect:e=>{if(!r)return;const t=l.$el.find(".attachments");t.addClass("mm-loading"),null!==e?l.$el.addClass("mm-folder-filtered"):l.$el.removeClass("mm-folder-filtered"),r.props.unset("media_folder"),r.props.unset("media_folder_exclude"),"uncategorized"===e?r.props.set({media_folder_exclude:"all"}):e&&""!==e&&r.props.set({media_folder:parseInt(e,10)}),r.reset(),r.more({remove:!1}).then(()=>{t.removeClass("mm-loading")}).catch(()=>{t.removeClass("mm-loading")})}})),this.$el.addClass("mm-has-folder-sidebar"),function(e,t){const n=e.$el.find(".attachments-wrapper").first(),a=e.$el.find(".attachments").first();if(!n.length||!a.length)return;const r=n[0];let l=!1;function o(){const e=r.getBoundingClientRect(),n=r.scrollTop>0;n&&!l?(t.style.position="fixed",t.style.top=`${e.top}px`,t.style.left=`${e.left}px`,t.style.height=`${e.height}px`,t.style.width="220px",t.style.zIndex="100",l=!0):!n&&l?(t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.height="100%",t.style.width="",t.style.zIndex="",l=!1):l&&(t.style.top=`${e.top}px`,t.style.left=`${e.left}px`,t.style.height=`${e.height}px`)}r.addEventListener("scroll",()=>{requestAnimationFrame(o)},{passive:!0}),window.addEventListener("resize",o,{passive:!0}),setTimeout(o,100)}(this,a)}}return this}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",c):c()})();