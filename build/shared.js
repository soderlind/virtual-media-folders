(()=>{"use strict";var e={n:a=>{var t=a&&a.__esModule?()=>a.default:()=>a;return e.d(t,{a:t}),t},d:(a,t)=>{for(var r in t)e.o(t,r)&&!e.o(a,r)&&Object.defineProperty(a,r,{enumerable:!0,get:t[r]})},o:(e,a)=>Object.prototype.hasOwnProperty.call(e,a),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},a={};e.r(a),e.d(a,{AddonShell:()=>j,BaseFolderItem:()=>v,BaseFolderTree:()=>m,LiveRegion:()=>p,SUB_TABS:()=>b,StatsCard:()=>w,StatusIndicator:()=>h,SubTabNav:()=>_,buildTree:()=>o,useAnnounce:()=>i,useFolderData:()=>d,useMoveMode:()=>c});const t=window.wp.element,r=window.wp.apiFetch;var n=e.n(r);const l="vmfo_folders_cache";function o(e){const a={},t=[];return e.forEach(e=>{a[e.id]={...e,children:[]}}),e.forEach(e=>{e.parent&&a[e.parent]?a[e.parent].children.push(a[e.id]):t.push(a[e.id])}),t}function d({trackUrl:e=!1,onFolderSelect:a,mediaType:r="",defaultFolder:d=null}={}){const s=function(){if(window.vmfData?.folders)return window.vmfData.folders;if(window.vmfEditor?.folders)return window.vmfEditor.folders;try{const e=localStorage.getItem(l);if(e)return JSON.parse(e)}catch(e){}return null}()||[],i=s.length>0?o(s):[],c=s.length>0,[u,f]=(0,t.useState)(i),[v,m]=(0,t.useState)(s),[p,b]=(0,t.useState)(d),[_,h]=(0,t.useState)(!c),[g,w]=(0,t.useState)(0),x=(0,t.useRef)(c?s:null),j=(0,t.useRef)(a);(0,t.useEffect)(()=>{j.current=a},[a]);const N=(0,t.useRef)(!1),y=(0,t.useRef)(!0);(0,t.useEffect)(()=>(y.current=!0,()=>{y.current=!1}),[]);const C=(0,t.useCallback)(e=>[...e].sort((e,a)=>{const t=e.vmfo_order,r=a.vmfo_order;return null!=t&&null!=r?t-r:null!=t?-1:null!=r?1:e.name.localeCompare(a.name)}),[]),S=(0,t.useCallback)((e,a=null)=>{const t=C(e),r=a?t.map(e=>{var t;return{...e,count:null!==(t=a[e.id])&&void 0!==t?t:e.count}}):t;m(r),f(o(r))},[C]),k=(0,t.useCallback)(async(e,a)=>{try{const t=function(e){if(!e||"all"===e)return"";if(e.includes("/")||e.includes(",")){const a=e.split(",")[0].split("/")[0];return["image","video","audio","application","text"].includes(a)?a:""}return e}(e);let r="/wp/v2/media?per_page=1";t&&(r+=`&media_type=${encodeURIComponent(t)}`);const l=await n()({path:r,parse:!1});if(!y.current)return;const o=parseInt(l.headers.get("X-WP-Total"),10)||0;let d=0;a.forEach(e=>{d+=e.count||0}),w(Math.max(0,o-d))}catch(e){}},[]),E=(0,t.useCallback)(async(e=r,a=!1)=>{try{const t=await n()({path:"/vmfo/v1/folders"});if(!y.current)return;const r=a||!function(e,a){if(!e||!a)return!1;if(e.length!==a.length)return!1;const t=e=>JSON.stringify(e.map(e=>({id:e.id,name:e.name,parent:e.parent,vmfo_order:e.vmfo_order})));return t(e)===t(a)}(x.current,t);r&&(S(t),function(e){try{localStorage.setItem(l,JSON.stringify(e))}catch(e){}}(t),x.current=t);let o=t;if(e)try{const a=await n()({path:`/vmfo/v1/folders/counts?media_type=${encodeURIComponent(e)}`});if(!y.current)return;o=t.map(e=>{var t;return{...e,count:null!==(t=a[e.id])&&void 0!==t?t:e.count}}),S(o)}catch(e){}k(e,o)}catch(e){console.error("Error fetching folders:",e)}finally{y.current&&h(!1)}},[r,S,k]);(0,t.useEffect)(()=>{if(N.current)return;N.current=!0;let a=d;if(e){const e=new URLSearchParams(window.location.search),t=e.get("vmfo_folder"),r=e.get("mode");t?(a="uncategorized"===t?"uncategorized":parseInt(t,10),b(a)):"folder"===r?(b(d),a=d):"grid"!==r&&"list"!==r||(a=null,b(null))}E(),null!==a&&j.current?.(a)},[E,e,d]),(0,t.useEffect)(()=>{void 0!==r&&E(r)},[r,E]);const M=(0,t.useCallback)(e=>{b(e),j.current?.(e)},[]);return{folders:u,flatFolders:v,selectedId:p,setSelectedId:b,loading:_,uncategorizedCount:g,fetchFolders:E,handleSelect:M}}const s=window.wp.i18n,i=function(){const[e,a]=(0,t.useState)(""),r=(0,t.useCallback)(e=>{a(""),setTimeout(()=>a(e),100)},[]),n=(0,t.useCallback)((e,a)=>{r((0,s.sprintf)(/* translators: 1: file name, 2: folder name */ /* translators: 1: file name, 2: folder name */
(0,s.__)("Moved %1$s to %2$s","virtual-media-folders"),e,a))},[r]),l=(0,t.useCallback)((e,a)=>{r((0,s.sprintf)(/* translators: 1: number of files, 2: folder name */ /* translators: 1: number of files, 2: folder name */
(0,s.__)("Moved %1$d files to %2$s","virtual-media-folders"),e,a))},[r]),o=(0,t.useCallback)((e,a)=>{r((0,s.sprintf)(/* translators: 1: folder name, 2: position number */ /* translators: 1: folder name, 2: position number */
(0,s.__)("%1$s moved to position %2$d","virtual-media-folders"),e,a))},[r]),d=(0,t.useCallback)((e,a)=>{r((0,s.sprintf)(/* translators: 1: folder name, 2: item count */ /* translators: 1: folder name, 2: item count */
(0,s.__)("%1$s folder selected, %2$d items","virtual-media-folders"),e,a))},[r]),i=(0,t.useCallback)(e=>{r((0,s.sprintf)(/* translators: %s: folder name */ /* translators: %s: folder name */
(0,s.__)("Folder %s created","virtual-media-folders"),e))},[r]),c=(0,t.useCallback)(e=>{r((0,s.sprintf)(/* translators: %s: folder name */ /* translators: %s: folder name */
(0,s.__)("Folder %s deleted","virtual-media-folders"),e))},[r]),u=(0,t.useCallback)(e=>{r((0,s.sprintf)(/* translators: %s: item name */ /* translators: %s: item name */
(0,s.__)("Dragging %s. Drop on a folder to move.","virtual-media-folders"),e))},[r]),f=(0,t.useCallback)(()=>{r((0,s.__)("Drag cancelled","virtual-media-folders"))},[r]);return{announcement:e,announce:r,announceMove:n,announceBulkMove:l,announceReorder:o,announceFolderSelected:d,announceFolderCreated:i,announceFolderDeleted:c,announceDragStart:u,announceDragCancelled:f}},c=function(e){const[a,r]=(0,t.useState)(null),[n,l]=(0,t.useState)(""),o=(0,t.useCallback)(e=>{l(""),setTimeout(()=>l(e),100)},[]),d=(0,t.useCallback)(e=>{if(!e||0===e.length)return;r(e);const a=1===e.length?(0,s.sprintf)(/* translators: %s: media item title */ /* translators: %s: media item title */
(0,s.__)("%s picked up. Navigate to a folder and press Enter to drop, or press M or Escape to cancel.","virtual-media-folders"),e[0].title||(0,s.__)("Item","virtual-media-folders")):(0,s.sprintf)(/* translators: %d: number of items */ /* translators: %d: number of items */
(0,s.__)("%d items picked up. Navigate to a folder and press Enter to drop, or press M or Escape to cancel.","virtual-media-folders"),e.length);o(a)},[o]),i=(0,t.useCallback)(()=>{a&&(r(null),o((0,s.__)("Move cancelled","virtual-media-folders")))},[a,o]),c=(0,t.useCallback)((t,n)=>{if(!a||0===a.length)return;const l=a;r(null),l.forEach(a=>{e?.(a.id,t)});const d=1===l.length?(0,s.sprintf)(/* translators: 1: media item title, 2: folder name */ /* translators: 1: media item title, 2: folder name */
(0,s.__)("Moved %1$s to %2$s","virtual-media-folders"),l[0].title||(0,s.__)("item","virtual-media-folders"),n||(0,s.__)("folder","virtual-media-folders")):(0,s.sprintf)(/* translators: 1: number of items, 2: folder name */ /* translators: 1: number of items, 2: folder name */
(0,s.__)("Moved %1$d items to %2$s","virtual-media-folders"),l.length,n||(0,s.__)("folder","virtual-media-folders"));o(d)},[a,e,o]),u=(0,t.useCallback)(e=>{a?i():d(e)},[a,i,d]);return(0,t.useEffect)(()=>(window.vmfMoveMode={isActive:()=>!!a,getGrabbedMedia:()=>a,pickUp:d,cancel:i,drop:c,toggle:u},()=>{delete window.vmfMoveMode}),[a,d,i,c,u]),{grabbedMedia:a,announcement:n,isActive:!!a,pickUp:d,cancel:i,drop:c,toggle:u}},u=window.ReactJSXRuntime;function f({expanded:e}){return(0,u.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:e?(0,u.jsx)("polyline",{points:"6 9 12 15 18 9"}):(0,u.jsx)("polyline",{points:"9 6 15 12 9 18"})})}function v({folder:e,selectedId:a,onSelect:r,level:n=0,parentId:l=null,renderWrapper:o,enableKeyboardNav:d=!1,enableAutoExpand:i=!1,enableAria:c=!1,isMoveModeActive:m=!1,forceExpand:p=!1}){const b=e=>!(!e.children||0===e.children.length)&&e.children.some(e=>e.id===a||b(e)),_=i&&b(e),[h,g]=(0,t.useState)(_),w=p||h||_,x=e.children&&e.children.length>0,j=a===e.id;(0,t.useEffect)(()=>{_&&!h&&g(!0)},[_,h]);const N=(0,u.jsxs)("button",{type:"button",className:"vmf-folder-button "+(j?"is-selected":""),style:{paddingLeft:16*n+8+"px"},onClick:()=>r(e.id),onKeyDown:d?a=>{if(d)if("ArrowRight"===a.key&&x&&!w)a.preventDefault(),g(!0);else if("ArrowLeft"===a.key)a.preventDefault(),x&&w?g(!1):null!==l&&r(l);else if("Enter"===a.key||" "===a.key){if(m)return;a.preventDefault(),r(e.id)}}:void 0,"aria-current":j?"true":void 0,title:e.name,children:[x?(0,u.jsx)("span",{className:"vmf-folder-toggle",onClick:a=>{a.stopPropagation(),w&&b(e)&&r(e.id),g(!w)},onKeyDown:d?a=>{"Enter"!==a.key&&" "!==a.key||(a.preventDefault(),a.stopPropagation(),w&&b(e)&&r(e.id),g(!w))}:void 0,role:d?"button":void 0,tabIndex:d?0:void 0,"aria-label":w?(0,s.__)("Collapse","virtual-media-folders"):(0,s.__)("Expand","virtual-media-folders"),children:(0,u.jsx)(f,{expanded:w})}):(0,u.jsx)("span",{className:"vmf-folder-toggle vmf-folder-toggle--placeholder","aria-hidden":"true"}),(0,u.jsx)("span",{className:"vmf-folder-name",children:e.name}),"number"==typeof e.count&&!(x&&0===e.count)&&(0,u.jsxs)("span",{className:"vmf-folder-count","aria-label":c?`${e.count} ${(0,s.__)("items","virtual-media-folders")}`:void 0,children:["(",e.count,")"]})]}),y=o?o({folderId:e.id,children:N}):N,C=c?{role:"treeitem","aria-expanded":x?w:void 0,"aria-selected":j}:{};return(0,u.jsxs)("li",{className:"vmf-folder-item",...C,children:[y,x&&w&&(0,u.jsx)("ul",{className:"vmf-folder-children",role:c?"group":void 0,children:e.children.map(t=>(0,u.jsx)(v,{folder:t,selectedId:a,onSelect:r,level:n+1,parentId:e.id,renderWrapper:o,enableKeyboardNav:d,enableAutoExpand:i,enableAria:c,isMoveModeActive:m,forceExpand:p},t.id))})]})}function m({folders:e,selectedId:a,onSelect:t,uncategorizedCount:r,showAllMedia:n=!0,showUncategorized:l=!0,loading:o,renderWrapper:d,renderUncategorizedWrapper:i,renderHeader:c,enableKeyboardNav:f=!1,enableAutoExpand:m=!1,enableAria:p=!1,isMoveModeActive:b=!1,forceExpand:_=!1,className:h="",loadingText:g}){if(o){const e=p?"vmf-folder-tree":"vmf-folder-sidebar";return(0,u.jsx)("div",{className:`${e} ${e}--loading ${h}`,"aria-label":p?(0,s.__)("Media folders","virtual-media-folders"):void 0,children:(0,u.jsx)("p",{"aria-live":p?"polite":void 0,children:g||(0,s.__)("Loading…","virtual-media-folders")})})}const w=(0,u.jsx)("button",{type:"button",className:"vmf-folder-button "+(null===a?"is-selected":""),onClick:()=>t(null),"aria-current":null===a?"true":void 0,children:(0,u.jsx)("span",{className:"vmf-folder-name",children:(0,s.__)("All Media","virtual-media-folders")})}),x=(0,u.jsxs)("button",{type:"button",className:"vmf-folder-button "+("uncategorized"===a?"is-selected":""),onClick:()=>t("uncategorized"),"aria-current":"uncategorized"===a?"true":void 0,children:[(0,u.jsx)("span",{className:"vmf-folder-name",children:(0,s.__)("Uncategorized","virtual-media-folders")}),(0,u.jsxs)("span",{className:"vmf-folder-count","aria-label":p?`${r} ${(0,s.__)("items","virtual-media-folders")}`:void 0,children:["(",r,")"]})]}),j=i?i({children:x}):x,N=p?"nav":"div",y=p?"vmf-folder-tree":"vmf-folder-sidebar";return(0,u.jsxs)(N,{className:`${y} ${h}`,"aria-label":p?(0,s.__)("Media folders","virtual-media-folders"):void 0,children:[c&&c(),(0,u.jsxs)("ul",{className:"vmf-folder-list",role:p?"tree":void 0,"aria-label":p?(0,s.__)("Folder tree","virtual-media-folders"):void 0,children:[n&&(0,u.jsx)("li",{className:"vmf-folder-item",role:p?"treeitem":void 0,"aria-selected":p?null===a:void 0,children:w}),l&&(0,u.jsx)("li",{className:"vmf-folder-item",role:p?"treeitem":void 0,"aria-selected":p?"uncategorized"===a:void 0,children:j}),e.map(e=>(0,u.jsx)(v,{folder:e,selectedId:a,onSelect:t,renderWrapper:d,enableKeyboardNav:f,enableAutoExpand:m,enableAria:p,isMoveModeActive:b,forceExpand:_},e.id))]})]})}const p=function({announcement:e}){return(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)("div",{"aria-live":"polite","aria-atomic":"true",className:"vmf-sr-only",role:"status",children:e}),(0,u.jsx)("div",{id:"vmf-drag-instructions",className:"vmf-sr-only",children:(0,s.__)("Press Space or Enter to start dragging. Use arrow keys to move. Press Space or Enter again to drop, or Escape to cancel.","virtual-media-folders")})]})},b=[{id:"overview",label:(0,s.__)("Overview","virtual-media-folders")},{id:"dashboard",label:(0,s.__)("Dashboard","virtual-media-folders")},{id:"configure",label:(0,s.__)("Configure","virtual-media-folders")},{id:"actions",label:(0,s.__)("Actions","virtual-media-folders")},{id:"logs",label:(0,s.__)("Logs","virtual-media-folders")}];function _({activeTab:e="overview",onTabChange:a,disabledTabs:t={},baseUrl:r="",className:n=""}){return(0,u.jsx)("nav",{className:`vmfo-subtab-nav ${n}`.trim(),role:"tablist","aria-label":(0,s.__)("Add-on sections","virtual-media-folders"),children:b.map(n=>{const l=e===n.id,o=t[n.id],d=r?`${r}&subtab=${n.id}`:`#${n.id}`;return(0,u.jsx)("a",{href:d,role:"tab","aria-selected":l,"aria-disabled":o||void 0,"aria-current":l?"page":void 0,className:`vmfo-subtab-nav__tab ${l?"vmfo-subtab-nav__tab--active":""} ${o?"vmfo-subtab-nav__tab--disabled":""}`.trim(),onClick:e=>{return r=e,l=n.id,void(t[l]?r.preventDefault():a&&(r.preventDefault(),a(l)));var r,l},tabIndex:o?-1:0,children:n.label},n.id)})})}function h({enabled:e=!0,className:a=""}){const t=e?(0,s.__)("Enabled","virtual-media-folders"):(0,s.__)("Disabled","virtual-media-folders");return(0,u.jsxs)("span",{className:`vmfo-status-indicator ${a}`.trim(),"aria-label":e?(0,s.__)("Add-on is enabled","virtual-media-folders"):(0,s.__)("Add-on is disabled","virtual-media-folders"),children:[(0,u.jsx)("span",{className:"vmfo-status-indicator__text",children:(0,s.__)("Status:","virtual-media-folders")}),(0,u.jsx)("span",{className:"vmfo-status-indicator__value "+(e?"vmfo-status-indicator__value--enabled":"vmfo-status-indicator__value--disabled"),children:t}),(0,u.jsx)("span",{className:"vmfo-status-indicator__dot "+(e?"vmfo-status-indicator__dot--enabled":"vmfo-status-indicator__dot--disabled"),"aria-hidden":"true"})]})}const g=window.wp.components;function w({stats:e=[],className:a=""}){const t=[...e.slice(0,4),...Array(Math.max(0,4-e.length)).fill({label:"",value:""})].slice(0,4);return(0,u.jsx)("div",{className:`vmfo-stats-card ${a}`.trim(),children:t.map((e,a)=>{var t;return(0,u.jsxs)("div",{className:"vmfo-stats-card__item",children:[(0,u.jsx)("div",{className:"vmfo-stats-card__value",children:e.isLoading?(0,u.jsx)(g.Spinner,{}):null!==(t=e.value)&&void 0!==t?t:"—"}),(0,u.jsx)("div",{className:"vmfo-stats-card__label",children:e.label||" "})]},e.label||a)})})}function x(){const e=new URLSearchParams(window.location.search).get("subtab");return b.map(e=>e.id).includes(e)?e:"overview"}function j({addonKey:e,addonLabel:a,enabled:r=!0,description:n="",stats:l=[],disabledTabs:o={},overviewContent:d,dashboardContent:s,configureContent:i,actionsContent:c,logsContent:f,className:v=""}){const[m,p]=(0,t.useState)(x);(0,t.useEffect)(()=>{const e=()=>{p(x())};return window.addEventListener("popstate",e),()=>window.removeEventListener("popstate",e)},[]);const b=(0,t.useCallback)(a=>{p(a),function(e){const a=new URL(window.location.href);a.searchParams.set("subtab",e),window.history.pushState({},"",a.toString())}(a),window.dispatchEvent(new CustomEvent("vmfo-subtab-change",{detail:{addonKey:e,tabId:a}}))},[e]),g=window.location.href.split("&subtab=")[0].split("#")[0];return(0,u.jsxs)("div",{className:`vmfo-addon-shell vmfo-addon-shell--${e} ${v}`.trim(),children:[(0,u.jsxs)("div",{className:"vmfo-addon-shell__header",children:[(0,u.jsx)("h2",{className:"vmfo-addon-shell__title",children:a}),(0,u.jsx)(h,{enabled:r})]}),(0,u.jsx)(_,{activeTab:m,onTabChange:b,disabledTabs:o,baseUrl:g}),(0,u.jsx)("div",{className:"vmfo-addon-shell__content",role:"tabpanel","aria-labelledby":`tab-${m}`,children:(()=>{switch(m){case"overview":default:return d||(0,u.jsx)(N,{tabId:"overview"});case"dashboard":return s||(0,u.jsx)(N,{tabId:"dashboard"});case"configure":return i||(0,u.jsx)(N,{tabId:"configure"});case"actions":return c||(0,u.jsx)(N,{tabId:"actions"});case"logs":return f||(0,u.jsx)(N,{tabId:"logs"})}})()})]})}function N({tabId:e}){const a={overview:(0,s.__)("Overview content not configured.","virtual-media-folders"),dashboard:(0,s.__)("Dashboard content not configured.","virtual-media-folders"),configure:(0,s.__)("No settings available for this add-on.","virtual-media-folders"),actions:(0,s.__)("No actions available for this add-on.","virtual-media-folders"),logs:(0,s.__)("Logs feature coming soon.","virtual-media-folders")};return(0,u.jsx)("div",{className:"vmfo-addon-shell__empty-state",children:(0,u.jsx)("p",{children:a[e]||a.overview})})}(window.vmfo=window.vmfo||{}).shared=a})();